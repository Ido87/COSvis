---
title: "Notes: COSvis"
author: "Daniel Klotz, Johannes Wesemann, Mathew Herrnegger"
output:
  pdf_document: 
    highlight: kate
urlcolor: red
---
## Introduction
**COSvis** is an R based visualisation tool for **COSEROreg**. It is still in its infancy and currently maintained by [Daniel Klotz](https://online.boku.ac.at/BOKUonline/visitenkarte.show_vcard?pPersonenId=6E56AD7273C135A3&pPersonenGruppe=3). We hope that it will soon grow into a nice and usefull tool. 

The purpose of this document is to collect notes regarding its usage and future developements. It is structured as following: Firstly, in *1. Overview* the program requirements and structure is presented. In *2. Setup*  a short help for the program-usage is given. Section *3. Control Options* gives a list of the options for manipulation the program output.

## 1. Overview 
**COSvis** makes extenstive use of R-packages. To date, the following packages are in use: *dplyr*, *ggplot2*, *gridExtra*, *hydroGOF*, *shiny* & *xts* (see: 2. Setup). The "program" comprises the following files:

```{r, eval=FALSE}
* folder::"APP"
    + file::"calculations.R"
    + file::"server.R"
    + file::"ui.R"
    + folder::"www"
          - file::"bootstrap.CSS"
          - ...
* file::"COSvis_notes.pdf"
* file::"COSvis_notes.Rmd"
* file::"start.R"
* file::"readme.md"
```

Furthermore, the code is currently not DRY (but aspires to be so, asap!). In this case DRY is an acronym DRY and stands for "Don't Repeat Yourself"; which is a programming paradigm that tries to minimize the amount of repeated code, while pertaining legibility. Currently the entire calculations are done before the App/Visualsiation itself runs. In future versions this will be done more smartely. Nevertheless, parts of the code have allready been optimised with regards to calculation-speed, e.g.: Most "big" loops have been transformed in [a-z]pply statements or vectorized directly. 




## 2. Setup 
1. Download & install the R programming language from from [https://www.r-project.org/](https://www.r-project.org/) (It might also be usefull to get and IDE, such as [Rstudio](https://www.rstudio.com/) ). 
2. Open R & install the needed packages: 
```{r, eval=FALSE}
      install.packages("data.table")
      install.packages("shiny")
      install.packages("hydroGOF")
      install.packages("ggplot2")
      install.packages("xts")
      install.packages("dplyr")
      install.packages("grid")
      install.packages("gridExtra")
      install.packages("dygraphs")
```
3. Open start.R in your COSvis folder and set up the options according to your will (see: ctrl-Cheatsheet). 
4. Now you can either 
    + copy the start.R and paste it into your R command window, or
    + execute start.R from the IDE of your choice

## 3. Control Options
### 3.1. The `ctrl` Variable 
The `ctrl` variable is the main or basic control mechanism. It is basically a list in which the options can be defined. These definitions can be set in the start.R file. 
The `ctrl` variable is structured in the following way

Variable  | Description | Format
---------------- | -------------  | ------------- 
`ctrl$pathtoCosero` | Path to the **COSEROreg** folder | string::path
`ctrl$pathtoApp` | Path to App folder in **COSvis** | string::path
`ctrl$ofoldername` | Path to output folder in **COSEROreg** | string::folder
`ctrl$ctrl_span` | timespan for the header year | {integer::year1,integer::year2} 
`ctrl$colors` | colors for the pltos | {string::col1,...,string::col4}
`ctrl$clr_NSEmid` | midpoint of the color scale for the NSE | real::value
`ctrl$yearName` | string for the x-axis title of the hydrological years | string::Name

### 3.2. The `plt_ctrl` Variable 
The `plt_ctrl` variable is a list, which containts the control options for the different plot functions (see: chapter 4). Care: Not all plotting functions make use of all options! The options can be set in the calculations.R file. Currently the list is structured as following:

Variable  | Description | Format
---------------- | -------------  | ------------- 
`plt_ctrl$gtitle` | title | string::name
`plt_ctrl$ylab` | label of the y-Axis | string::name
`plt_ctrl$xlab` | label of the y-Axis | string::name
`plt_ctrl$clr1` | color for the lowest value | string::name
`plt_ctrl$clr2` | color for the midpoint | string::name
`plt_ctrl$clr3` | color for the highest value | string::name
`plt_ctrl$clr4`  | extra color | string::name
`plt_ctrl$midpoint` | midpoint of the color ramp | real::value
`plt_ctrl$limits` | lower and upper y-limit of the plotted data | {real::value,real::value}
`plt_ctrl$lb_cut` | lower boundary (min) | real::value

### 3.3. The `s_ctrl` Variable 
COSvis will export additional files into the `'~/App/out/'` and `/App/www/` folder. The different save options are controlled with the 's_ctrl' variable. The control is realised via a list witch can be given to the save functions. Currently (v.0.2) only few additional files are produced:

  - (a) The summary table of the NSE is written into the `'~/App/out/'` folder
  - (b) html files & jpegs are written into the `/App/www/` folder. The former are blank files which show the later. 
  
Thus, the `s_ctrl` options are rather limited. Currently the following funcitionality is implemented for the function `save_expnd_barplts`

Variable | Description | Format | Function
---------------- | -------------  | ------------- | ------------- 
`s_ctrl$hmtlfilename` | file name of the html file | string::name | `save_expnd_barplts`
`s_ctrl$jpgfilename` | basic file name of the jpegs | string::name | `save_expnd_barplts`


## 4. Functions
Follows soon

***

