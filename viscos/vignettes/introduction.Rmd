# Introduction

```{r setup1, include=FALSE, purl=FALSE}
  knitr::opts_chunk$set(eval = FALSE, tidy = FALSE, fig.align = 'center')
```

This guide defines the code for the R-package visCOS and provides instructions,
examples and tips for using it.

The goal of visCOS is to provide a possibility to streamline the R based
visual-analysis for the hydrological model COSERO. COSERO is a HBV-like
distributed rainfall-runoff model, developed at the institute for water
management, hydrology and hydraulic engineering at BOKU, Vienna. The name is an
abbreviation for "Conceptual Semi-Distributed Rainfall Runoff Model".

visCOS is embedded into a broader effort that aims to establish practical and
easy-to-use workflows between R and COSERO. The overall concept of that project
is shown in **Figure xyz**. The R-package `coscos` provides the backbone
of the projects. It provides the basic interface between COSERO and R, generic
helper functions and primitives, and defines the options for all subsequent
package. Currently, visCOS is the only package that builds on it, but hopefully    
soon we will have more packages, ideas and scripts that are able to use it. s

**Figure xyz**

## visCOS and other R-package
There exist many R-packages dedicated to hydrology.

Among then, several have provide help to the calibration of (conceptual)
rainfall-runoff models. As their name suggests, these models relate the a
rainfall input to a generated runoff for some given basins They have found
a wide array of applications in hydrology. Form the analysis of catchment
properties to climate impact studies, so to speak. From the point o view of the
R package ecosystem there are to packages, which are of particular interest with
regard to **visCOS**:
The [`hydroGOF`](https://CRAN.R-project.org/package=hydroGOF) package and the
[`hydroTSM`](https://CRAN.R-project.org/package=hydroTSM) package. The former
provides the most commonly used (and discussed) objective functions. The
latter, helps with the analysis, interpolation and the plotting of hydrological
time series.

As an R-package that aim of **visCOS** is to provide visual aids for
the parameter estimation process of multiple (related) basins or catchments.

Thus, topic wise, visCOS can be positioned somewhere in-between the two
previously mentioned packages. visCOS is usable for conceptual rainfall
runoff models in general, but almost all of its functionality has been derived
from different applications of the COSERO model.

## cosdata
For visCOS raw-data is data directly taken from COSERO. In general, raw-data
can have many forms. The focus of visCOS are time series of observations, $o$,
and model simulations, $s$. It assumes that the data is already loaded in to R.

R has many options to read data. Most file-formats can be accessed with the
native `read.` functions (for an example enter `?read.table` in your R-terminal).
However, for larger files we recommend the read functionality of the
`data.table` package. In our tests it was fastest and most flexible choice.
Lastly, we recommend `readr` package for well structured and large data.

After the data is read into R it needs to be transformed (*cooked*) into a
rigidly defined format, which we call **cosdata**. The format has some redundant
columns, but provides a large optionality. It is also a good middle ground
between the output of COSERO and the formats used within the R ecosystem.

All cosdata formated data can be used for further exploratory analysis with
visCOS.

**NOW WE NEED TO EXPLAIN COSDATA!**

Snipptes:


Currently **visCOS** only allows to compare between *numbered catchments*! The
data **must** include an integer number at the end of its name, e.g.
`QObs_001` and `QSim_001`).

Additionally, `cos_data` data.frame needs to have two different definitions for
the date of a given row (see: [Introduction](introduction.html)). One is based
on an old way to write dates out in fortran code. In that case each column
represents a time-resolution. In concrete, the following columns are used:

-  *yyyy* - year,
- *mm* - month,
- *hh* - hour,
- *min* - minute.

The other format is a more modern way to define time information. That is,
the `POSIXct` format (see: [link](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html)).
This format is a standard for `R` and has many usages (e.g. transforming your
data frame into a time series).

visCOS can differentiate seasonal information on a monthly
resolution. The in- and out-of-period markings are stored in a separate column
(defined by `viscos_options("name_COSperiod")`). Here, each season is defined
by an number (integer), which starts 1 and is raised for each new season. A 0
indicates the out-of-period rows.

If needed, the column-names of the cosdata can adapted by using the
`viscos_options` function from `coscos` (alternatively one might prefer to set
the column-name the `data.frame` accordingly). Calling the function
`viscos_options()` will return a list with the available options. The available
options are as following:
```{r, purl=FALSE, eval=TRUE}
   # showing the options:
   library(magrittr)
   viscos_options( ) %>% unlist(.)
```

An option can be changed by providing the new option-value as functional
argument of the option. Here is an example for changing the $o$ column color:
```{r, purl=FALSE, eval=TRUE}

   # changing an option:
   coscos::viscos_options(color_o = "green")
   coscos::viscos_options( ) %>% unlist(.)
```

The `coscos` package also provides a function to get some exemplary data to use
in visCOS. Throughout this guide we will use it to demonstrate the different
functionalities of visCOS. The data can be loaded with the function
`viscos_example`, e.g.:
```{r, purl=FALSE, eval=TRUE, message=3:5}
  options(width=80)
  require(coscos)
  #
  raw_data_example <- viscos_example( )
  head(raw_data_example)
```

One can see that the example data still has some columns that are not needed for
further analysis, i.e. the columns `QOSI_0001` and `QOSI_0002`.


**Until here and not further**


```{r, purl=FALSE, eval=TRUE}
  library(ggplot2)
  raw_data_example %>%
    cook_cosdata(.) %>%
    ggplot(.) +
      geom_line( aes(x = posixdate, y = QOBS_0001))
```
