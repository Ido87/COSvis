# Cooking Data

```{r setup1, include=FALSE, purl=FALSE}
  knitr::opts_chunk$set(eval = FALSE, tidy = FALSE, fig.align = 'center')
```

This chapter defines the basic functions for adapting given (raw) in such a way
that it can be used for further use with **visCOS**. In the following we
exemplify the usage of these functions and then define their code.

## Examples
The function `get_viscos_example` can be used to get some exemplary data
from within **visCOS**:
```{r, purl=FALSE, eval=TRUE, message=3:5}
  options(width=80)
  require(visCOS)
  require(magrittr)
  #
  runoff_example_raw <- get_viscos_example( )
  head(runoff_example_raw)
```

Usually, one would then need to adapt the ([`viscos_options`](LP-viscos_options.html)
or name the `data.frame` appropriately. But, in this case the options
are already set as in the data:
```{r, purl=FALSE, eval=TRUE}
   viscos_options( ) %>% unlist(.)
```

A glimpse of the data shows that some columns - `QOSI_0001` and `QOSI_0002` -
are not needed for further analysis. We refer to these columns as junk. Another
example of junk would be columns where no observations are available. These
columns might has a purpose for some application or in the grater scheme of
things, but it has no use within **visCOS**. Hence, we need to
*throw the data away*.

The package provides a function for doing so. The `remove_junk` function. Here
is an example for its use:
```{r, purl=FALSE, eval=TRUE}
  runoff_example_raw %>%
    remove_junk(.) %>%
    head(.)
```

Additionally, `cos_data` data.frame needs to have two different definitions for
the date of a given row (see: [Introduction](introduction.html)). One is based
on an old way to write dates out in fortran code. In that case each column
represents a time-resolution. In concrete, the following columns are used:

-  *yyyy* - year,
- *mm* - month,
- *hh* - hour,
- *min* - minute.

The other format is a more modern way to define time information. That is,
the `POSIXct` format (see: [link](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html)).
This format is a standard for `R` and has many usages (e.g. transforming your
data frame into a time series). In this format all information is saved in one
column. The **visCOS** package has a function that can be used to generate one
of the formats if the other one is given. It is called `complete_dates`. Here
is an example:  
```{r, purl=FALSE, eval=TRUE}
  runoff_example_raw %>%
    remove_junk(.) %>%
    complete_dates(.) %>%
    head(.)
```

Lastly, **visCOS** can differentiate seasonal information on a monthly
resolution. The in- and out-of-period markings are stored in a separate column
(defined by `viscos_options("name_COSperiod")`). Here, each season is defined
by an number (integer), which starts 1 and is raised for each new season. A 0
indicates the out-of-period rows. The package provides a simple, yet imperfect,
helper to get those: The `mark_periods` function. In the following is an
example, where the (European) hydrological years, from September till August,
are used as seasons. Note, that the example data starts with beginning of
September, which is the first hydrological year. The end of the year 2010 is not
completely inside a hydrological year, thus the period counter jumps to one:
```{r, purl=FALSE, eval=TRUE}
  cooked_runoff_example <- runoff_example_raw %>%
    remove_junk(.) %>%
    complete_dates(.) %>%
    mark_periods(start_month = 9, end_month = 8)
  # here is an example plot to visualize the periods
  plot(cooked_runoff_example$period,
       xlab = "Timestep",
       ylab = "# of hydrological year")
```


