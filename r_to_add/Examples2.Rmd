---
title: "visCOS: Example 2"
output: 
  html_document:
    highlight: pygments
---
```{r, echo = FALSE, message=FALSE}
  require("visCOS")
  require("magrittr")
```

## Intro to the prepare_ functions
xxx
```{r}
  d_raw <- pour(runoff_example) # get example runoff
  d_runoff <- prepare(this = remove_chunk, from_that = d_raw)

```      

As a next step we might then want to remove unobserved basins. This can be done with `prepare_onlyObserved`
```{r}
  d_runoff <- prepare(this = remove_chunk, from_that = d_runoff)
  head(d_runoff)
```

Of course all this would be easier by using the pipes from the [magrittr](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html) package. That would simplify the last two steps, such to: `QobsNotObserved %<>% prepare_remove_chunk %>% prepare_only_observed`.

Some parts of **visCOS** make use of the dygraphs-package (xxx source) to enable an interactive exploration of time series. (namely xxx) To plot time series dygraphs requires an xts object or an object which is convertible to xts. Thus, for easy conversiuon the  `runoff_data data.frame (xxx)` can contains a column named *posixdate*, which contains the xts formatted dates. If our data.frame contains dates in the **COSdate** format, we can easily add the column with the `prepare_implode_cosdate` function. Noting that `prepare_implode_cosdate` assumes that your dates are UTC, not allowing any timeshifts within the data (see xxx: toughts on COSdate format). 

Since our data contains the **COSdate** date-columnswe can get the posix-date (needed for the dygraphs, by using the appropriate prepare function `prepare_implode_cosdate` and then transform it into the xts-data-structure with `pour_runoff_as_xts`
```{r}
  d_runoff$POSIXdate <- prepare(this = implode_cosdate, from_that = d_runoff)
```

```{r}
  d_runoff <- prepare_periods(d_runoff, start_month = 9, end_month = 8)
```

```{r}
  bOF <- serve_period_ofun(d_runoff)
  bOF
```


