<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>visCOS doc</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="visCOS doc">
  <meta name="generator" content="bookdown 0.1.7 and GitBook 2.6.7">

  <meta property="og:title" content="visCOS doc" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="visCOS doc" />
  
  
  

<meta name="author" content="Daniel Klotz, Johannes Wesemann, Mathew Herrnegger">


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="cook-data.html">
<link rel="next" href="options.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">visCOS documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#loading-raw-data"><i class="fa fa-check"></i><b>1.1</b> Loading raw data</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#the-basic-data-structure"><i class="fa fa-check"></i><b>1.2</b> The basic data structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-package.html"><a href="the-package.html"><i class="fa fa-check"></i><b>2</b> The Package</a></li>
<li class="chapter" data-level="3" data-path="cook-data.html"><a href="cook-data.html"><i class="fa fa-check"></i><b>3</b> Cook Data</a></li>
<li class="chapter" data-level="4" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>4</b> Code</a><ul>
<li class="chapter" data-level="4.1" data-path="code.html"><a href="code.html#get_cos_data_example"><i class="fa fa-check"></i><b>4.1</b> <code>get_cos_data_example</code></a></li>
<li class="chapter" data-level="4.2" data-path="code.html"><a href="code.html#remove_junk"><i class="fa fa-check"></i><b>4.2</b> <code>remove_junk</code></a><ul>
<li class="chapter" data-level="4.2.1" data-path="code.html"><a href="code.html#only_observed_basins"><i class="fa fa-check"></i><b>4.2.1</b> <code>only_observed_basins</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="code.html"><a href="code.html#complete_dates"><i class="fa fa-check"></i><b>4.3</b> <code>complete_dates</code></a><ul>
<li class="chapter" data-level="4.3.1" data-path="code.html"><a href="code.html#implode_cosdate"><i class="fa fa-check"></i><b>4.3.1</b> <code>implode_cosdate</code></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="code.html"><a href="code.html#remove_leading_zeros"><i class="fa fa-check"></i><b>4.4</b> <code>remove_leading_zeros</code></a></li>
<li class="chapter" data-level="4.5" data-path="code.html"><a href="code.html#mark_periods"><i class="fa fa-check"></i><b>4.5</b> <code>mark_periods</code></a></li>
<li class="chapter" data-level="4.6" data-path="code.html"><a href="code.html#cos_data_as_xts"><i class="fa fa-check"></i><b>4.6</b> <code>cos_data_as_xts</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="options.html"><a href="options.html"><i class="fa fa-check"></i><b>5</b> Options</a></li>
<li class="chapter" data-level="6" data-path="ojective-functions.html"><a href="ojective-functions.html"><i class="fa fa-check"></i><b>6</b> Ojective Functions</a></li>
<li class="chapter" data-level="7" data-path="objective-functions.html"><a href="objective-functions.html"><i class="fa fa-check"></i><b>7</b> Objective Functions</a><ul>
<li class="chapter" data-level="7.1" data-path="objective-functions.html"><a href="objective-functions.html#main-objective-functions"><i class="fa fa-check"></i><b>7.1</b> Main Objective Functions</a><ul>
<li class="chapter" data-level="7.1.1" data-path="objective-functions.html"><a href="objective-functions.html#nash-sutcliffe-efficiency"><i class="fa fa-check"></i><b>7.1.1</b> Nash-Sutcliffe Efficiency</a></li>
<li class="chapter" data-level="7.1.2" data-path="objective-functions.html"><a href="objective-functions.html#kling-gupta-efficiency"><i class="fa fa-check"></i><b>7.1.2</b> Kling-Gupta Efficiency</a></li>
<li class="chapter" data-level="7.1.3" data-path="objective-functions.html"><a href="objective-functions.html#percentage-bias"><i class="fa fa-check"></i><b>7.1.3</b> Percentage Bias</a></li>
<li class="chapter" data-level="7.1.4" data-path="objective-functions.html"><a href="objective-functions.html#pearsons-correlation-coefficient"><i class="fa fa-check"></i><b>7.1.4</b> Pearson’s correlation coefficient</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="objective-functions.html"><a href="objective-functions.html#ohter-objective-functions"><i class="fa fa-check"></i><b>7.2</b> Ohter Objective Functions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="objective-functions.html"><a href="objective-functions.html#root-mean-sqaured-error"><i class="fa fa-check"></i><b>7.2.1</b> Root Mean Sqaured Error</a></li>
<li class="chapter" data-level="7.2.2" data-path="objective-functions.html"><a href="objective-functions.html#inverted-nash-sutcliffe-efficiency"><i class="fa fa-check"></i><b>7.2.2</b> Inverted Nash-Sutcliffe Efficiency</a></li>
<li class="chapter" data-level="7.2.3" data-path="objective-functions.html"><a href="objective-functions.html#ratio-of-the-standard-deviations"><i class="fa fa-check"></i><b>7.2.3</b> Ratio of the Standard Deviations</a></li>
<li class="chapter" data-level="7.2.4" data-path="objective-functions.html"><a href="objective-functions.html#ratio-of-the-means"><i class="fa fa-check"></i><b>7.2.4</b> Ratio of the Means</a></li>
<li class="chapter" data-level="7.2.5" data-path="objective-functions.html"><a href="objective-functions.html#volumetric-efficiency"><i class="fa fa-check"></i><b>7.2.5</b> Volumetric Efficiency</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="chapter" data-level="9" data-path="time-aggregates.html"><a href="time-aggregates.html"><i class="fa fa-check"></i><b>9</b> Time Aggregates</a><ul>
<li class="chapter" data-level="9.1" data-path="time-aggregates.html"><a href="time-aggregates.html#examples"><i class="fa fa-check"></i><b>9.1</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="code-1.html"><a href="code-1.html"><i class="fa fa-check"></i><b>10</b> Code</a></li>
<li class="chapter" data-level="11" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html"><i class="fa fa-check"></i><b>11</b> Summaries of important objective functions</a></li>
<li class="chapter" data-level="12" data-path="code-2.html"><a href="code-2.html"><i class="fa fa-check"></i><b>12</b> Code</a><ul>
<li class="chapter" data-level="12.1" data-path="code-2.html"><a href="code-2.html#compute-the-main-objective-functions"><i class="fa fa-check"></i><b>12.1</b> Compute the Main Objective Functions</a></li>
<li class="chapter" data-level="12.2" data-path="code-2.html"><a href="code-2.html#plotting"><i class="fa fa-check"></i><b>12.2</b> Plotting</a><ul>
<li class="chapter" data-level="12.2.1" data-path="code-2.html"><a href="code-2.html#bar-plot"><i class="fa fa-check"></i><b>12.2.1</b> Bar Plot</a></li>
<li class="chapter" data-level="12.2.2" data-path="code-2.html"><a href="code-2.html#raster-plot"><i class="fa fa-check"></i><b>12.2.2</b> Raster-Plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html"><i class="fa fa-check"></i><b>13</b> Flow Duration Curves</a></li>
<li class="chapter" data-level="14" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>14</b> Example</a></li>
<li class="chapter" data-level="15" data-path="code-3.html"><a href="code-3.html"><i class="fa fa-check"></i><b>15</b> Code</a><ul>
<li class="chapter" data-level="15.1" data-path="code-3.html"><a href="code-3.html#computing-the-data-for-the-flow-duration-curves"><i class="fa fa-check"></i><b>15.1</b> Computing the data for the flow duration curves</a></li>
<li class="chapter" data-level="15.2" data-path="code-3.html"><a href="code-3.html#plotting-the-flow-duration-curves"><i class="fa fa-check"></i><b>15.2</b> Plotting the Flow duration curves</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i><b>16</b> References</a></li>
<li class="chapter" data-level="17" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html"><i class="fa fa-check"></i><b>17</b> Plotting Runoff Peaks Plots</a><ul>
<li class="chapter" data-level="17.1" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#examples-1"><i class="fa fa-check"></i><b>17.1</b> Examples:</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="code-4.html"><a href="code-4.html"><i class="fa fa-check"></i><b>18</b> Code</a><ul>
<li class="chapter" data-level="18.1" data-path="code-4.html"><a href="code-4.html#generating-the-plots-for-one-basin."><i class="fa fa-check"></i><b>18.1</b> Generating the Plots for one basin.</a></li>
<li class="chapter" data-level="18.2" data-path="code-4.html"><a href="code-4.html#function-to-find-peaks"><i class="fa fa-check"></i><b>18.2</b> Function to find peaks</a></li>
<li class="chapter" data-level="18.3" data-path="code-4.html"><a href="code-4.html#subplot-function"><i class="fa fa-check"></i><b>18.3</b> Subplot Function</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html"><i class="fa fa-check"></i><b>19</b> Exploring Objective Functions</a></li>
<li class="chapter" data-level="20" data-path="example-1.html"><a href="example-1.html"><i class="fa fa-check"></i><b>20</b> Example</a></li>
<li class="chapter" data-level="21" data-path="code-5.html"><a href="code-5.html"><i class="fa fa-check"></i><b>21</b> Code</a><ul>
<li class="chapter" data-level="21.1" data-path="code-5.html"><a href="code-5.html#explore_cos_data"><i class="fa fa-check"></i><b>21.1</b> <code>explore_cos_data</code></a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="making-previews.html"><a href="making-previews.html"><i class="fa fa-check"></i><b>22</b> Making Previews</a></li>
<li class="chapter" data-level="23" data-path="code-6.html"><a href="code-6.html"><i class="fa fa-check"></i><b>23</b> code</a></li>
<li class="chapter" data-level="24" data-path="defensive-code.html"><a href="defensive-code.html"><i class="fa fa-check"></i><b>24</b> Defensive Code</a></li>
<li class="chapter" data-level="25" data-path="code-7.html"><a href="code-7.html"><i class="fa fa-check"></i><b>25</b> Code</a><ul>
<li class="chapter" data-level="25.1" data-path="code-7.html"><a href="code-7.html#assert_junk"><i class="fa fa-check"></i><b>25.1</b> <code>assert_junk</code></a></li>
<li class="chapter" data-level="25.2" data-path="code-7.html"><a href="code-7.html#assert_complete_date"><i class="fa fa-check"></i><b>25.2</b> <code>assert_complete_date</code></a></li>
<li class="chapter" data-level="25.3" data-path="code-7.html"><a href="code-7.html#assert_dataframe"><i class="fa fa-check"></i><b>25.3</b> <code>assert_dataframe</code></a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="references-2.html"><a href="references-2.html"><i class="fa fa-check"></i><b>26</b> References</a></li>
<li class="chapter" data-level="27" data-path="helpers.html"><a href="helpers.html"><i class="fa fa-check"></i><b>27</b> Helpers</a></li>
<li class="chapter" data-level="28" data-path="code-8.html"><a href="code-8.html"><i class="fa fa-check"></i><b>28</b> Code</a><ul>
<li class="chapter" data-level="28.1" data-path="code-8.html"><a href="code-8.html#get_regex_for_cos_data"><i class="fa fa-check"></i><b>28.1</b> <code>get_regex_for_cos_data</code></a></li>
<li class="chapter" data-level="28.2" data-path="code-8.html"><a href="code-8.html#get_basin_numbers"><i class="fa fa-check"></i><b>28.2</b> <code>get_basin_numbers</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">visCOS doc</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="code" class="section level1">
<h1><span class="header-section-number">4</span> Code</h1>
<p>This function defines the data cooking functions.</p>
<div id="get_cos_data_example" class="section level2">
<h2><span class="header-section-number">4.1</span> <code>get_cos_data_example</code></h2>
<p>visCOS provides some exemplary data. All the available functions can be tested with it. <code>get_cos_data_example</code> is a small wrapper function to get the data from within the package via <code>read.csv</code></p>
<p><strong>Note</strong> at this stage, only a comparison between <strong>numbered catchments</strong> is possible for two parameters is possible. So the data must include an integer number after the description (like “QObs_001” and “QSim_001”)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Get runoff example</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Get exemplary runoff data to test the different functions of visCOS</span>
  <span class="co">#&#39; @export</span>
  get_cos_data_example &lt;-<span class="st"> </span>function() {
    file_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,
                             <span class="st">&quot;runoff_example.csv&quot;</span>,
                             <span class="dt">package =</span> <span class="st">&quot;visCOS&quot;</span>)
    runoff_example &lt;-<span class="st"> </span><span class="kw">read.csv</span>(file_path)
    <span class="kw">return</span>(runoff_example)
  }</code></pre></div>
</div>
<div id="remove_junk" class="section level2">
<h2><span class="header-section-number">4.2</span> <code>remove_junk</code></h2>
<p>This function removes all columns not specified in the <code>viscos_options</code>, as well basins where no <code>data_o</code> is available. <strong>Note</strong> that the routine is <strong>not</strong> case sensitive. It does not distinguish between small and capital letters!</p>
<p>The first part of the code loads the dependencies and makes sure that the <code>cos_data</code> variable is a data.frame (see: chapter about <em>defensive coding</em>).</p>
<p>The body of <code>remove_junk</code> works as following: First, the names of the columns of the <code>cos_data</code> are determined and <a href="LP-helpers.html">helper function</a> <code>get_regex_for_cos_data</code> is invoked to get regular expressions for the columns defined within <code>viscos_otopns</code>. Then the <code>idx</code> of the different wanted data is extracted and used to select the appropriate columns.</p>
<p>Afterwards, the “sub” function <code>only_observed_basins</code> is being executed (see next chapter)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; removes junk in cos_data</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Removes all columns which are not foreseen (see: viscos_options) from</span>
  <span class="co">#&#39; runoff data</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39; @param cos_data The cos_data data.frame (see vignette for info)</span>
  <span class="co">#&#39; @return data.frame object without the chunk</span>
  <span class="co">#&#39; @export</span>
  remove_junk &lt;-<span class="st"> </span>function(cos_data) {
    <span class="kw">assert_dataframe</span>(cos_data)
    <span class="co">#</span>
    names_in_data &lt;-<span class="st"> </span>cos_data %&gt;%<span class="st"> </span>names
    regex_columns &lt;-<span class="st"> </span><span class="kw">get_regex_for_cos_data</span>() <span class="co"># see: helpers</span>
    <span class="co">#</span>
    idx &lt;-<span class="st"> </span>regex_columns %&gt;%
<span class="st">      </span><span class="kw">grep</span>(.,names_in_data, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)
    no_junk_cos_data &lt;-<span class="st"> </span>cos_data[ , idx]
    <span class="kw">return</span>( <span class="kw">only_observed_basins</span>(no_junk_cos_data) )
  }</code></pre></div>
<div id="only_observed_basins" class="section level3">
<h3><span class="header-section-number">4.2.1</span> <code>only_observed_basins</code></h3>
<p>This function removes basins for which no data in the <code>o_data</code> column. No observation are columns where all the entries are either as defined in <code>viscos_options(&quot;missing_data&quot;)</code> or <code>NA's</code>. At the end of the function the former are transformed into <code>NA's</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># remove basins without observations</span>
  <span class="co">#</span>
  <span class="co"># Removes basins without observation (-999/NA values) from the provided data.frame</span>
  <span class="co">#</span>
  <span class="co"># @param cos_data A raw cos_data data.frame, which may contains basins</span>
  <span class="co"># without observations.</span>
  <span class="co"># \strong{Note:} It is assumed that all available basins are simulated!</span>
  <span class="co"># @return data.frame without the observation-free basins</span>
  <span class="co">#</span>
  <span class="co"># @import magrittr</span>
  <span class="co"># @import pasta</span>
  only_observed_basins &lt;-<span class="st"> </span>function(cos_data) {
    <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>)
    <span class="kw">require</span>(<span class="st">&quot;pasta&quot;</span>)
    <span class="kw">assert_dataframe</span>(cos_data)
    <span class="co"># set NA values to viscos_options(&quot;missing_data&quot;) and check if there are</span>
    <span class="co"># cloumns wihtouth observervation</span>
    chosen_cols &lt;-<span class="st"> </span><span class="kw">which</span>( <span class="kw">names</span>(cos_data) !=<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>) )
    rows_with_na &lt;-<span class="st"> </span><span class="kw">is.na</span>(cos_data[,chosen_cols])
    data_wihtouth_posix &lt;-<span class="st"> </span>cos_data[ ,chosen_cols]
    data_wihtouth_posix[rows_with_na] &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;missing_data&quot;</span>)
    colmax &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dt">X =</span> data_wihtouth_posix, <span class="dt">FUN =</span> max)
    <span class="co">#</span>
    <span class="co"># if there are columns withouth observations remove them from the data:</span>
    if ( <span class="kw">any</span>(colmax &lt;<span class="st"> </span><span class="fl">0.0</span>) ){
      name_o &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_o&quot;</span>)
      neg_obs_names &lt;-<span class="st"> </span><span class="kw">which</span>(colmax &lt;<span class="st"> </span><span class="fl">0.0</span>) %&gt;%
<span class="st">        </span>names %&gt;%
<span class="st">        </span><span class="kw">grepl</span>(name_o %.%<span class="st"> &quot;*&quot;</span>,.,<span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">        </span>idx_temp[.]
      neg_s_names &lt;-<span class="st"> </span><span class="kw">gsub</span>(name_o,<span class="kw">viscos_options</span>(<span class="st">&quot;name_s&quot;</span>),neg_obs_names,<span class="dt">ignore.case =</span> <span class="ot">TRUE</span> )
      data_selection &lt;-<span class="st"> </span>neg_obs_names %|%<span class="st"> </span>neg_s_names %&gt;%
<span class="st">        </span><span class="kw">grepl</span>(., <span class="kw">names</span>(cos_data), <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">        </span><span class="kw">not</span>(.)
      data_only_observed &lt;-<span class="st"> </span>cos_data[ ,data_selection]

    } else {
      data_only_observed &lt;-<span class="st"> </span>cos_data
    }
    <span class="co"># set all missing data values to NA for use in hydroGOF</span>
    idx_NA &lt;-<span class="st"> </span>data_only_observed %&gt;%
<span class="st">      </span><span class="kw">equals</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;missing_data&quot;</span>))
    data_only_observed[idx_NA] &lt;-<span class="st"> </span><span class="ot">NA</span>
    <span class="kw">return</span>(data_only_observed)
  }</code></pre></div>
</div>
</div>
<div id="complete_dates" class="section level2">
<h2><span class="header-section-number">4.3</span> <code>complete_dates</code></h2>
<p>This function is not finished yet! Within cos_data data.frame (see: <a href="Introduction.html">introduction</a>) the date has to be defined in two formats: With 5 columns, where the columns are year-month-day-hour-minute and names as defined in <code>viscos_options()</code> and with one column in <code>POSIXct</code> format (see: <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html">link</a>), that is named as defined in <code>viscos_options(&quot;name_COSposix&quot;)</code>. The idea of the <code>complete_dates</code> fucntion is to provide a internal posibility to create the one format out of the ohter and thus <em>complete the dates</em>.</p>
<p><strong>However</strong>, currently it is only possible to convert the 5-columns representation into <code>POSIXct</code> dates via the internally defined <code>implode_cosdate</code> function.</p>
<p>Also by using <em>UTC</em> a <strong>fixed time-zone</strong> is assumed within visCOS to avoid problems with leaps in time (summer/winter time).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Complete the date-formats with POSIXct or COSdate</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Complete the data-formats of your data.frame `POSIXct` and/or `COSdate`</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data The data.frame, which contains the runoff information</span>
  <span class="co">#&#39; @param name_cosyear string with the name of the `COSdate` year column</span>
  <span class="co">#&#39; @param name_posix string with the name of the POSIXct column</span>
  <span class="co">#&#39; @return The new runoff data.frame with the added data-format.</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @export</span>
complete_dates &lt;-<span class="st"> </span>function(cos_data) {
  <span class="co"># make sure that magrittr is loaded:</span>
  <span class="kw">assert_dataframe</span>(cos_data)
  <span class="co"># check for COSdates and stop if non-logical expression are obtained</span>
  OK_COSdate &lt;-<span class="st"> </span><span class="kw">any</span>(
    <span class="kw">unlist</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>,
                          <span class="st">&quot;name_COSmonth&quot;</span>,
                          <span class="st">&quot;name_COSmonth&quot;</span>,
                          <span class="st">&quot;name_COShour&quot;</span>,
                          <span class="st">&quot;name_COSmin&quot;</span>)
                           )
    %in%
<span class="st">    </span><span class="kw">names</span>(cos_data)
  )
  OK_POSIXdates &lt;-<span class="st"> </span><span class="kw">any</span>(<span class="kw">names</span>(cos_data) ==<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>))
  if ( !<span class="kw">is.logical</span>(OK_COSdate) |<span class="st"> </span>!<span class="kw">is.logical</span>(OK_POSIXdates) ) {
    <span class="kw">stop</span>(<span class="st">&quot;Something is wrong :( </span><span class="ch">\n</span>
<span class="st">         some of the date-columns could not be processed!&quot;</span>)
  }
  <span class="co"># choose function depending on which formats are available!</span>
  if (!OK_COSdate &amp;<span class="st"> </span>!OK_POSIXdates) {
    <span class="kw">stop</span>(<span class="st">&quot;Something is wrong :( </span><span class="ch">\n</span>
<span class="st">         The 5 cosero date columns and the POSIXct colum could not be found&quot;</span>)
  } else if (OK_COSdate &amp;<span class="st"> </span>!OK_POSIXdates) {
    cos_data &lt;-<span class="st"> </span><span class="kw">implode_cosdate</span>(cos_data) <span class="co"># see following chapter</span>
  } else if (!OK_COSdate &amp;<span class="st"> </span>OK_POSIXdates) {
    <span class="kw">stop</span>(<span class="st">&quot;POSIXct to COSdates not yet supported :(&quot;</span>)
  }
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
<div id="implode_cosdate" class="section level3">
<h3><span class="header-section-number">4.3.1</span> <code>implode_cosdate</code></h3>
<p>This function is used to transform the “old-school” 5 column format into the widely spread POSIXct format. The function is not exported and should only be called from within <code>complete_date()</code>!. Also, thanks to Christoph Schürz for his help with conception.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">implode_cosdate &lt;-<span class="st"> </span>function(cos_data) {
  <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
  <span class="kw">assert_dataframe</span>(cos_data)
  name_string &lt;-<span class="st">  </span>cos_data %&gt;%<span class="st"> </span>names %&gt;%<span class="st"> </span>tolower
  <span class="co">#</span>
  POSIXdate &lt;-<span class="st"> </span><span class="kw">paste</span>(cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]],
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSday&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COShour&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmin&quot;</span>)]]),
                     <span class="dt">sep=</span> <span class="st">&quot;&quot;</span> ) %&gt;%
<span class="st">    </span><span class="kw">as.POSIXct</span>(<span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>, <span class="dt">origin =</span> .[<span class="dv">1</span>], <span class="dt">scale =</span> <span class="st">&quot;hourly&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>)
  cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>)]] &lt;-<span class="st"> </span>POSIXdate
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
</div>
</div>
<div id="remove_leading_zeros" class="section level2">
<h2><span class="header-section-number">4.4</span> <code>remove_leading_zeros</code></h2>
<p>This internal function removes leading zeros from column names of the <code>cos_data</code> data.frame. The function has no defensive code but uses <code>remove_junk</code> (see: above). It should therefore be used with care!</p>
<p><strong>Sad Note:</strong> The current solution is bit suboptimal as many operations are needed and different tricks are used (e.g. <code>as.numeric %&gt;% as.character</code>) to obtain the wanted result. We hope that better solutions can be found in the future.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove leading zeros from the names of cos_data (data.frame)</span>
remove_leading_zeros &lt;-<span class="st"> </span>function(cos_data) {
  <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
  cos_data %&lt;&gt;%<span class="st"> </span>remove_junk
  <span class="co">#</span>
  runoff_names &lt;-<span class="st"> </span>cos_data %&gt;%<span class="st"> </span>names
  runoff_lowercase_names &lt;-<span class="st"> </span>runoff_names %&gt;%<span class="st"> </span>tolower
  <span class="co">#</span>
  separator &lt;-<span class="st"> </span>runoff_lowercase_names %&gt;%
<span class="st">    </span><span class="kw">extract</span>( <span class="kw">grep</span>(<span class="kw">viscos_options</span>()$name_o,.) ) %&gt;%
<span class="st">    </span><span class="kw">extract</span>( <span class="dv">1</span> ) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="kw">viscos_options</span>()$name_o,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>,<span class="st">&quot;&quot;</span>,.)
  searchterm &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">viscos_options</span>()$name_o,<span class="st">&quot;|&quot;</span>, <span class="kw">viscos_options</span>()$name_s)
  runoff_nums &lt;-<span class="st"> </span>runoff_lowercase_names %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(searchterm,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(separator,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">D&quot;</span>,<span class="st">&quot;&quot;</span>,.)
  searchterm &lt;-<span class="st"> </span><span class="kw">paste</span>(runoff_nums, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
  runoff_only_names &lt;-<span class="st"> </span>runoff_names %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="kw">paste0</span>(<span class="st">&quot;[&quot;</span>,searchterm,<span class="st">&quot;]&quot;</span>),<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(separator,<span class="st">&quot;&quot;</span>,.)
  runoff_new_numbers &lt;-<span class="st"> </span>runoff_nums %&gt;%
<span class="st">    </span><span class="kw">as.numeric</span>() %&gt;%
<span class="st">    </span><span class="kw">as.character</span>()
  runoff_new_numbers[<span class="kw">is.na</span>(runoff_new_numbers)] &lt;-<span class="st"> &quot;&quot;</span>
  <span class="co">#</span>
  <span class="kw">names</span>(cos_data) &lt;-<span class="st"> </span>runoff_new_numbers %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>,separator,.) %&gt;%
<span class="st">    </span><span class="kw">paste0</span>(runoff_only_names,.,runoff_new_numbers)
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
</div>
<div id="mark_periods" class="section level2">
<h2><span class="header-section-number">4.5</span> <code>mark_periods</code></h2>
<p>This function can be used to create a <code>viscos_options(&quot;name_COSperiod&quot;)</code>. The period column is a vector of increasing integer that is set to 0 for rows that are out of the period.</p>
<p>The current solution for defining this columns is not realy satisfying, but the problem seems to be non-trival… Life is short and it was the best that the authors could come out with so far.</p>
<p>In its current iteration the function takes <code>cos_data</code> and the two integers <code>start_month</code> and <code>end_month</code> as inputs, that can be used to define the to-be marked periods. The function can be directly used on raw data since the <code>remove_junk</code> and <code>complete_dates</code> are internaly applied to. This does however also mean that it needs to be used with care!</p>
<p>The computation is done in the following way: (I) Before starting the acutal marking the variable <code>period_range</code> and the <code>out_of_period</code> vector is defined. (II) With the help of the vectors the periods can be marked in two steps:</p>
<ul>
<li>First, all the starting months within cos_data are marked and the cumulative sum is used to count the periods within the data.frame. At the beginning of the first period, the counter is at “1” and becomes “2” with the beginning of the second period and so on.</li>
<li>Secondly, the <code>out_of_period</code> of all years is set back to zero again by checking which months of the data are equal to the <code>out_of_period</code> entries.</li>
</ul>
<p>There are at least two apparent problems with that solution:</p>
<ul>
<li>One problem is that the last year is not extracted properly if <code>start_month</code> &gt; <code>end_month</code>. To compensate this problem the <code>dplyr</code> shenanigans are added at the end of the fucntion.</li>
<li>The other problem is that that the first and last period are also included in the solution even if they are <strong>not</strong> complete!</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; calculate periods</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Mark the periods within cos_data.</span>
  <span class="co"># The marking uses a monthly resolution, which are defined by the integers</span>
  <span class="co">#&#39; `start_month` and `end_month`.  </span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data The data.frame, which contains the runoff information</span>
  <span class="co">#&#39; @return The runoff data.frame reduced and ordered according to the</span>
  <span class="co">#&#39; hydrological years within the data.</span>
  <span class="co">#&#39; \strong{Note:} The periods columns are formatted as characters!</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import dplyr</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @export</span>
mark_periods &lt;-<span class="st"> </span>function(cos_data, <span class="dt">start_month =</span> <span class="dv">10</span>, <span class="dt">end_month =</span> <span class="dv">9</span>) {
  <span class="kw">assert_dataframe</span>(cos_data)
  cos_data %&lt;&gt;%<span class="st"> </span>remove_junk %&gt;%<span class="st"> </span><span class="kw">complete_dates</span>()
  <span class="co"># (I) get labels for the months</span>
  if (start_month &lt;=<span class="st"> </span>end_month ) {
    period_range &lt;-<span class="st"> </span><span class="kw">seq</span>(start_month,end_month)
    out_of_period &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %&gt;%<span class="st"> </span><span class="kw">extract</span>( !(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %in%<span class="st"> </span>period_range) )
  } else if (start_month &gt;<span class="st"> </span>end_month) {
    range_1 &lt;-<span class="st"> </span><span class="kw">seq</span>(start_month,<span class="dv">12</span>)
    range_2 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,end_month)
    period_range &lt;-<span class="st"> </span><span class="kw">c</span>(range_1,range_2)
    out_of_period &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %&gt;%<span class="st"> </span><span class="kw">extract</span>( !(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %in%<span class="st"> </span>period_range) )
  }

  <span class="co"># (II) mark periods:</span>
    eval_diff &lt;-<span class="st"> </span>function(a) {<span class="kw">c</span>(a[<span class="dv">1</span>],<span class="kw">diff</span>(a))}
    cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSperiod&quot;</span>)]] &lt;-
<span class="st">      </span>cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] %in%<span class="st"> </span><span class="kw">c</span>(start_month) %&gt;%
<span class="st">      </span>eval_diff %&gt;%
<span class="st">      </span><span class="kw">pmax</span>(.,<span class="dv">0</span>) %&gt;%
<span class="st">      </span>cumsum
    cos_data$period[cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] %in%<span class="st"> </span>out_of_period] &lt;-<span class="st"> </span><span class="dv">0</span>
    <span class="co"># corrections for last year</span>
    max_year &lt;-<span class="st"> </span><span class="kw">max</span>(cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]])
    cos_data %&lt;&gt;%<span class="st"> </span>dplyr::<span class="kw">mutate</span>(
      <span class="dt">period =</span> <span class="kw">ifelse</span>(
        (  (.[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]] ==<span class="st"> </span>max_year) &amp;
<span class="st">           </span>(.[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] &gt;<span class="st"> </span>end_month)  ),
                      <span class="dv">0</span>,
                      period
        )
      )
    <span class="kw">return</span>(cos_data)
}</code></pre></div>
<p>Here are two additonal examples that display the slected periods and the numbering:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(magrittr)
<span class="kw">require</span>(visCOS)
<span class="co"># mark_periods example 1: Hydrological years (September till August)</span>
<span class="co"># note that the last year is not complete, so the counter jumps back to 0</span>
ex1 &lt;-<span class="st"> </span><span class="kw">get_cos_data_example</span>() %&gt;%<span class="st"> </span><span class="kw">mark_periods</span>(.,<span class="dt">start_month =</span> <span class="dv">9</span>, <span class="dt">end_month =</span> <span class="dv">8</span>)
<span class="kw">plot</span>(ex1$period, <span class="dt">xlab=</span><span class="st">&quot;Timestep&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;# of hydrological year&quot;</span>)</code></pre></div>
<p><img src="visdoc_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mark_periods example 2: Summer Months (June till August)</span>
ex2 &lt;-<span class="st"> </span><span class="kw">get_cos_data_example</span>() %&gt;%<span class="st"> </span><span class="kw">mark_periods</span>(.,<span class="dt">start_month =</span> <span class="dv">6</span>, <span class="dt">end_month =</span> <span class="dv">8</span>)
<span class="kw">plot</span>(ex2$period, <span class="dt">xlab=</span><span class="st">&quot;Timestep&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;# year of summer months&quot;</span>)</code></pre></div>
<p><img src="visdoc_files/figure-html/unnamed-chunk-12-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="cos_data_as_xts" class="section level2">
<h2><span class="header-section-number">4.6</span> <code>cos_data_as_xts</code></h2>
<p>This function is actually just a small wrapper around the <code>xts::xts</code> function for the purposes of <strong>visCOS</strong>.</p>
<p>A notable quirk of the function is that the names of the header are put to lower cases via the <code>tolower</code> function and possible leading zeros in the enumeration of the basins are removed.</p>
<p>Currently it is not exported as users can use <code>xts</code> themselves perfectly well, and it is felt that the function does not provide enough added value for the user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Convert cos_data to xts-format</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Converts the cos_data (class: data_frame) into an xts object</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data data_frame of the cos_data (see: xxx)</span>
  <span class="co">#&#39; @return xts object of the cos_data data.frame</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import zoo</span>
  <span class="co">#&#39; @importFrom xts xts</span>
  <span class="co">#&#39; @import magrittr</span>
cos_data_as_xts &lt;-<span class="st"> </span>function(cos_data) {
  <span class="co"># pre</span>
  <span class="kw">assert_dataframe</span>(cos_data)
  <span class="kw">assert_junk</span>(cos_data)
  <span class="kw">assert_complete_date</span>(cos_data)
  <span class="co"># everything is set to lower case</span>
  cos_data &lt;-<span class="st"> </span><span class="kw">remove_leading_zeros</span>(cos_data) %&gt;%
<span class="st">    </span>magrittr::<span class="kw">set_names</span>(<span class="kw">names</span>(cos_data) %&gt;%<span class="st"> </span>tolower)
  name_posix &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>) %&gt;%<span class="st"> </span>tolower
  cos_data_as_xts &lt;-<span class="st"> </span><span class="kw">xts</span>(<span class="dt">x =</span> cos_data[], <span class="co"># ,names(cos_data) != name_posix</span>
                            <span class="dt">order.by =</span> cos_data[[name_posix]])
  <span class="co">#</span>
  <span class="kw">return</span>(cos_data_as_xts)
}</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cook-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="options.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
