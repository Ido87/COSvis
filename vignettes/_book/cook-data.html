<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>visCOS: documentation</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="visCOS: documentation">
  <meta name="generator" content="bookdown 0.1.7 and GitBook 2.6.7">

  <meta property="og:title" content="visCOS: documentation" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="visCOS: documentation" />
  
  
  

<meta name="author" content="Daniel Klotz, Johannes Wesemann, Mathew Herrnegger">


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="options.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">visCOS: documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Hello, traveler</a></li>
<li class="chapter" data-level="1" data-path="cook-data.html"><a href="cook-data.html"><i class="fa fa-check"></i><b>1</b> Cook Data</a><ul>
<li class="chapter" data-level="1.1" data-path="cook-data.html"><a href="cook-data.html#the-basic-data-structure"><i class="fa fa-check"></i><b>1.1</b> The basic data structure</a></li>
<li class="chapter" data-level="1.2" data-path="cook-data.html"><a href="cook-data.html#loading-raw-data"><i class="fa fa-check"></i><b>1.2</b> Loading raw data</a></li>
<li class="chapter" data-level="1.3" data-path="cook-data.html"><a href="cook-data.html#examples"><i class="fa fa-check"></i><b>1.3</b> Examples</a></li>
<li class="chapter" data-level="1.4" data-path="cook-data.html"><a href="cook-data.html#code"><i class="fa fa-check"></i><b>1.4</b> Code</a><ul>
<li class="chapter" data-level="1.4.1" data-path="cook-data.html"><a href="cook-data.html#get-example-data"><i class="fa fa-check"></i><b>1.4.1</b> Get Example Data</a></li>
<li class="chapter" data-level="1.4.2" data-path="cook-data.html"><a href="cook-data.html#remove-not-needed-columns"><i class="fa fa-check"></i><b>1.4.2</b> Remove not needed columns</a></li>
<li class="chapter" data-level="1.4.3" data-path="cook-data.html"><a href="cook-data.html#complete-the-date-formats"><i class="fa fa-check"></i><b>1.4.3</b> Complete the date formats</a></li>
<li class="chapter" data-level="1.4.4" data-path="cook-data.html"><a href="cook-data.html#remove-leading-zeros-in-column-names"><i class="fa fa-check"></i><b>1.4.4</b> Remove leading zeros in column names</a></li>
<li class="chapter" data-level="1.4.5" data-path="cook-data.html"><a href="cook-data.html#mark-the-needed-periods"><i class="fa fa-check"></i><b>1.4.5</b> Mark the needed periods</a></li>
<li class="chapter" data-level="1.4.6" data-path="cook-data.html"><a href="cook-data.html#transform-the-cos_data-into-xts"><i class="fa fa-check"></i><b>1.4.6</b> Transform the <code>cos_data</code> into <code>xts</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="options.html"><a href="options.html"><i class="fa fa-check"></i><b>2</b> Options</a></li>
<li class="chapter" data-level="3" data-path="ojective-functions.html"><a href="ojective-functions.html"><i class="fa fa-check"></i><b>3</b> Ojective Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="ojective-functions.html"><a href="ojective-functions.html#code-1"><i class="fa fa-check"></i><b>3.1</b> Code</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ojective-functions.html"><a href="ojective-functions.html#the-main-objective-functions"><i class="fa fa-check"></i><b>3.1.1</b> The “Main” Objective Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="ojective-functions.html"><a href="ojective-functions.html#ohter-objective-functions"><i class="fa fa-check"></i><b>3.1.2</b> Ohter Objective Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ojective-functions.html"><a href="ojective-functions.html#references"><i class="fa fa-check"></i><b>3.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="time-aggregates.html"><a href="time-aggregates.html"><i class="fa fa-check"></i><b>4</b> Time Aggregates</a><ul>
<li class="chapter" data-level="4.1" data-path="time-aggregates.html"><a href="time-aggregates.html#examples-1"><i class="fa fa-check"></i><b>4.1</b> Examples</a></li>
<li class="chapter" data-level="4.2" data-path="time-aggregates.html"><a href="time-aggregates.html#code-2"><i class="fa fa-check"></i><b>4.2</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html"><i class="fa fa-check"></i><b>5</b> Summaries of important objective functions</a><ul>
<li class="chapter" data-level="5.1" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#code-3"><i class="fa fa-check"></i><b>5.1</b> Code</a><ul>
<li class="chapter" data-level="5.1.1" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#compute-the-main-objective-functions"><i class="fa fa-check"></i><b>5.1.1</b> Compute the Main Objective Functions</a></li>
<li class="chapter" data-level="5.1.2" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#plotting"><i class="fa fa-check"></i><b>5.1.2</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html"><i class="fa fa-check"></i><b>6</b> Flow Duration Curves</a><ul>
<li class="chapter" data-level="6.1" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#example"><i class="fa fa-check"></i><b>6.1</b> Example</a></li>
<li class="chapter" data-level="6.2" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#code-4"><i class="fa fa-check"></i><b>6.2</b> Code</a><ul>
<li class="chapter" data-level="6.2.1" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#computing-the-data-for-the-flow-duration-curves"><i class="fa fa-check"></i><b>6.2.1</b> Computing the data for the flow duration curves</a></li>
<li class="chapter" data-level="6.2.2" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#plotting-the-flow-duration-curves"><i class="fa fa-check"></i><b>6.2.2</b> Plotting the Flow duration curves</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#references-1"><i class="fa fa-check"></i><b>6.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html"><i class="fa fa-check"></i><b>7</b> Plotting Runoff Peaks Plots</a><ul>
<li class="chapter" data-level="7.1" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#examples-2"><i class="fa fa-check"></i><b>7.1</b> Examples:</a></li>
<li class="chapter" data-level="7.2" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#code-5"><i class="fa fa-check"></i><b>7.2</b> Code</a><ul>
<li class="chapter" data-level="7.2.1" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#generating-the-plots-for-one-basin."><i class="fa fa-check"></i><b>7.2.1</b> Generating the Plots for one basin.</a></li>
<li class="chapter" data-level="7.2.2" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#function-to-find-peaks"><i class="fa fa-check"></i><b>7.2.2</b> Function to find peaks</a></li>
<li class="chapter" data-level="7.2.3" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#subplot-function"><i class="fa fa-check"></i><b>7.2.3</b> Subplot Function</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#references-2"><i class="fa fa-check"></i><b>7.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html"><i class="fa fa-check"></i><b>8</b> Exploring Objective Functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#example-1"><i class="fa fa-check"></i><b>8.1</b> Example</a></li>
<li class="chapter" data-level="8.2" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#code-6"><i class="fa fa-check"></i><b>8.2</b> Code</a><ul>
<li class="chapter" data-level="8.2.1" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#explore-the-data"><i class="fa fa-check"></i><b>8.2.1</b> Explore the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="generate-previews.html"><a href="generate-previews.html"><i class="fa fa-check"></i><b>9</b> Generate Previews</a><ul>
<li class="chapter" data-level="9.1" data-path="generate-previews.html"><a href="generate-previews.html#code-7"><i class="fa fa-check"></i><b>9.1</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="defensive-code.html"><a href="defensive-code.html"><i class="fa fa-check"></i><b>10</b> Defensive Code</a><ul>
<li class="chapter" data-level="10.1" data-path="defensive-code.html"><a href="defensive-code.html#code-8"><i class="fa fa-check"></i><b>10.1</b> Code</a><ul>
<li class="chapter" data-level="10.1.1" data-path="defensive-code.html"><a href="defensive-code.html#check-if-cos_data-is-clean"><i class="fa fa-check"></i><b>10.1.1</b> Check if <code>cos_data</code> is “clean”</a></li>
<li class="chapter" data-level="10.1.2" data-path="defensive-code.html"><a href="defensive-code.html#check-date-completeness"><i class="fa fa-check"></i><b>10.1.2</b> Check date completeness</a></li>
<li class="chapter" data-level="10.1.3" data-path="defensive-code.html"><a href="defensive-code.html#check-if-the-data-is-a-data.frame"><i class="fa fa-check"></i><b>10.1.3</b> Check if the data is a <code>data.frame</code></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="defensive-code.html"><a href="defensive-code.html#references-3"><i class="fa fa-check"></i><b>10.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="helpers.html"><a href="helpers.html"><i class="fa fa-check"></i><b>11</b> Helpers</a><ul>
<li class="chapter" data-level="11.1" data-path="helpers.html"><a href="helpers.html#code-9"><i class="fa fa-check"></i><b>11.1</b> Code</a><ul>
<li class="chapter" data-level="11.1.1" data-path="helpers.html"><a href="helpers.html#get-a-regular-expression-string-for-the-needed-columns"><i class="fa fa-check"></i><b>11.1.1</b> Get a Regular Expression String for the needed columns</a></li>
<li class="chapter" data-level="11.1.2" data-path="helpers.html"><a href="helpers.html#extract-the-numeration-of-the-basins"><i class="fa fa-check"></i><b>11.1.2</b> Extract the numeration of the basins</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">visCOS: documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cook-data" class="section level1">
<h1><span class="header-section-number">1</span> Cook Data</h1>
<p>Within <strong>visCOS</strong> “cooking data” is is used as a synonym for the process of transforming <em>raw data</em> into <em>cooked data</em>, that is data in the <a href="Introduction.html">COSERO data.frame</a> format. The <em>cooked data</em> can then be used for figures and other things. The package already provides a set of basic functions for that task that were useful for the applications at the institute.</p>
<p>This section defines these functions and explains their usage. Currently the following steps can be performed from within <strong>visCOS</strong>_</p>
<ul>
<li>Provide example data</li>
<li>Remove junk</li>
<li>Prepare date formats</li>
<li>Define periods</li>
</ul>
<div id="the-basic-data-structure" class="section level2">
<h2><span class="header-section-number">1.1</span> The basic data structure</h2>
<p>Shall follow</p>
</div>
<div id="loading-raw-data" class="section level2">
<h2><span class="header-section-number">1.2</span> Loading raw data</h2>
<p>From the point of view of <strong>visCOS</strong> raw-data are time-series of observations and model output. Usually raw data is saved in some simple file format, e.g. <em>.txt</em> or <em>.csv</em>. <code>R</code> already includes many option to read those files with the <code>read.table</code> functionalities. For larger unstructured files the read options of the <code>data.table</code> package is recommended. In our tests it was fastest and most flexible option. Alternatively the <code>readr</code> can be used if the data is more structured and large.</p>
<p><strong>Note</strong> at this stage, only a comparison between <strong>numbered catchments</strong> for two parameters is possible. So the data must include an integer number after the description (like “QObs_001” and “QSim_001”).</p>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">1.3</span> Examples</h2>
<p>The function <code>get_cos_data_example</code> can be used to get some exemplary data from within <strong>visCOS</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(visCOS)
  <span class="kw">require</span>(magrittr)
  <span class="kw">options</span>(<span class="dt">width=</span><span class="dv">80</span>)
  runoff_example_raw &lt;-<span class="st"> </span><span class="kw">get_cos_data_example</span>()
  <span class="kw">head</span>(runoff_example_raw)</code></pre></div>
<pre><code>##   yyyy mm dd hh min QOBS_0001 QOSI_0001 QSIM_0001 QOBS_0002 QOSI_0002 QSIM_0002
## 1 2007  1  1  0   0      2.98      3.48      3.48      2.56      3.11      3.11
## 2 2007  1  1  1   0      2.89      3.48      3.48      2.56      3.11      3.11
## 3 2007  1  1  2   0      2.64      3.48      3.48      2.57      3.11      3.11
## 4 2007  1  1  3   0      2.51      3.48      3.48      2.57      3.11      3.11
## 5 2007  1  1  4   0      2.42      3.48      3.48      2.57      3.11      3.11
## 6 2007  1  1  5   0      2.34      3.49      3.49      2.57      3.11      3.11</code></pre>
<p>The next step would be to adapt the options (<a href="LP-viscos_options.html"><code>viscos_options</code></a>, but in this case the options are already set as in the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   <span class="kw">viscos_options</span>() %&gt;%<span class="st"> </span><span class="kw">unlist</span>()</code></pre></div>
<pre><code>##         name_o         name_s      data_unit   name_COSyear  name_COSmonth 
##         &quot;qobs&quot;         &quot;qsim&quot;      &quot;(m^3/s)&quot;         &quot;yyyy&quot;           &quot;mm&quot; 
##    name_COSday   name_COShour    name_COSmin  name_COSposix name_COSperiod 
##           &quot;dd&quot;           &quot;hh&quot;          &quot;min&quot;    &quot;posixdate&quot;       &quot;period&quot; 
##   missing_data        color_o        color_s     of_limits1     of_limits2 
##         &quot;-999&quot;    &quot;steelblue&quot;       &quot;orange&quot;            &quot;0&quot;            &quot;1&quot;</code></pre>
<p>However, a glimpse of the data above shows that some of the columns (<code>QOSI_0001</code> and <code>QOSI_0002</code>) are not needed for the analysis. All the junk data, i.e. data columns that are not defined within the options and unobserved columns can be removed using the <code>remove_junk</code> function. Additionally <strong>visCOS</strong> needs to have two different ways to define the date of a given row (see: <a href="Introduction.html">Introduction</a>). In the runoff_example each part of the date definition is defined with a column: “yyyy” - year, “mm” - month, “hh” - hour, “min” - minute. The other needed format is the POSIXct<code>format (see: [link](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html)) format often used within R. Here all the information is saved within one column Given one date format is available in the data.frame the other can be generated by using</code>complete_dates`.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  runoff_example_raw %&gt;%
<span class="st">    </span><span class="kw">remove_junk</span>() %&gt;%
<span class="st">    </span><span class="kw">complete_dates</span>() %&gt;%
<span class="st">    </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##   yyyy mm dd hh min QOBS_0001 QSIM_0001 QOBS_0002 QSIM_0002           posixdate
## 1 2007  1  1  0   0      2.98      3.48      2.56      3.11 2007-01-01 00:00:00
## 2 2007  1  1  1   0      2.89      3.48      2.56      3.11 2007-01-01 01:00:00
## 3 2007  1  1  2   0      2.64      3.48      2.57      3.11 2007-01-01 02:00:00
## 4 2007  1  1  3   0      2.51      3.48      2.57      3.11 2007-01-01 03:00:00
## 5 2007  1  1  4   0      2.42      3.48      2.57      3.11 2007-01-01 04:00:00
## 6 2007  1  1  5   0      2.34      3.49      2.57      3.11 2007-01-01 05:00:00</code></pre>
<p>Lastly, if a seasonal or periodical analysis of the data wants to be done, these periods can be defined with the <code>mark_periods</code> function. In the example case, the hydrological years, going from September till August, will be defined:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  cooked_runoff_example &lt;-<span class="st"> </span>runoff_example_raw %&gt;%
<span class="st">    </span><span class="kw">remove_junk</span>() %&gt;%
<span class="st">    </span><span class="kw">complete_dates</span>() %&gt;%
<span class="st">    </span><span class="kw">mark_periods</span>(., <span class="dt">start_month =</span> <span class="dv">9</span>, <span class="dt">end_month =</span> <span class="dv">8</span>)
<span class="co"># here is an example plot to visualise the periods</span>
  <span class="kw">plot</span>(cooked_runoff_example$period,
       <span class="dt">xlab =</span> <span class="st">&quot;Timestep&quot;</span>,
       <span class="dt">ylab =</span> <span class="st">&quot;# of hydrological year&quot;</span>)</code></pre></div>
<p><img src="visdoc_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Note that the example data starts with beginning of September, so right with the first hydrological year. The end of the year 2010 is not completely inside a hydrological year, so the period counter jumps to one.</p>
</div>
<div id="code" class="section level2">
<h2><span class="header-section-number">1.4</span> Code</h2>
<p>This function defines the data cooking functions.</p>
<div id="get-example-data" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Get Example Data</h3>
<p>visCOS provides some exemplary data. All the available functions can be tested with it. <code>get_cos_data_example</code> is a small wrapper function to get the data from within the package via <code>read.csv</code></p>
<p><strong>Note</strong> at this stage, only a comparison between <strong>numbered catchments</strong> is possible for two parameters is possible. So the data must include an integer number after the description (like “QObs_001” and “QSim_001”)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Get runoff example</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Get exemplary runoff data to test the different functions of visCOS</span>
  <span class="co">#&#39; @export</span>
  get_cos_data_example &lt;-<span class="st"> </span>function() {
    file_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,
                             <span class="st">&quot;runoff_example.csv&quot;</span>,
                             <span class="dt">package =</span> <span class="st">&quot;visCOS&quot;</span>)
    runoff_example &lt;-<span class="st"> </span><span class="kw">read.csv</span>(file_path)
    <span class="kw">return</span>(runoff_example)
  }</code></pre></div>
</div>
<div id="remove-not-needed-columns" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Remove not needed columns</h3>
<p>This function removes all columns not specified in the <code>viscos_options</code>, as well basins where no <code>data_o</code> is available. <strong>Note</strong> that the routine is <strong>not</strong> case sensitive. It does not distinguish between small and capital letters!</p>
<p>The first part of the code loads the dependencies and makes sure that the <code>cos_data</code> variable is a data.frame (see: chapter about <em>defensive coding</em>).</p>
<p>The body of <code>remove_junk</code> works as following: First, the names of the columns of the <code>cos_data</code> are determined and <a href="LP-helpers.html">helper function</a> <code>get_regex_for_cos_data</code> is invoked to get regular expressions for the columns defined within <code>viscos_otopns</code>. Then the <code>idx</code> of the different wanted data is extracted and used to select the appropriate columns.</p>
<p>Afterwards, the “sub” function <code>only_observed_basins</code> is being executed (see next chapter)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; removes junk in cos_data</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Removes all columns which are not foreseen (see: viscos_options) from</span>
  <span class="co">#&#39; runoff data</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39; @param cos_data The cos_data data.frame (see vignette for info)</span>
  <span class="co">#&#39; @return data.frame object without the chunk</span>
  <span class="co">#&#39; @export</span>
  remove_junk &lt;-<span class="st"> </span>function(cos_data) {
    <span class="kw">assert_dataframe</span>(cos_data)
    <span class="co">#</span>
    names_in_data &lt;-<span class="st"> </span>cos_data %&gt;%<span class="st"> </span>names
    regex_columns &lt;-<span class="st"> </span><span class="kw">get_regex_for_cos_data</span>() <span class="co"># see: helpers</span>
    <span class="co">#</span>
    idx &lt;-<span class="st"> </span>regex_columns %&gt;%
<span class="st">      </span><span class="kw">grep</span>(.,names_in_data, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)
    no_junk_cos_data &lt;-<span class="st"> </span>cos_data[ , idx]
    <span class="kw">return</span>( <span class="kw">only_observed_basins</span>(no_junk_cos_data) )
  }</code></pre></div>
<div id="get-only-observed-basins" class="section level4">
<h4><span class="header-section-number">1.4.2.1</span> Get only observed basins</h4>
<p>This function removes basins for which no data in the <code>o_data</code> column. No observation are columns where all the entries are either as defined in <code>viscos_options(&quot;missing_data&quot;)</code> or <code>NA's</code>. At the end of the function the former are transformed into <code>NA's</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># remove basins without observations</span>
  <span class="co">#</span>
  <span class="co"># Removes basins without observation (-999/NA values) from the provided data.frame</span>
  <span class="co">#</span>
  <span class="co"># @param cos_data A raw cos_data data.frame, which may contains basins</span>
  <span class="co"># without observations.</span>
  <span class="co"># \strong{Note:} It is assumed that all available basins are simulated!</span>
  <span class="co"># @return data.frame without the observation-free basins</span>
  <span class="co">#</span>
  <span class="co"># @import magrittr</span>
  <span class="co"># @import pasta</span>
  only_observed_basins &lt;-<span class="st"> </span>function(cos_data) {
    <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>)
    <span class="kw">require</span>(<span class="st">&quot;pasta&quot;</span>)
    <span class="kw">assert_dataframe</span>(cos_data)
    <span class="co"># set NA values to viscos_options(&quot;missing_data&quot;) and check if there are</span>
    <span class="co"># cloumns wihtouth observervation</span>
    chosen_cols &lt;-<span class="st"> </span><span class="kw">which</span>( <span class="kw">names</span>(cos_data) !=<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>) )
    rows_with_na &lt;-<span class="st"> </span><span class="kw">is.na</span>(cos_data[,chosen_cols])
    data_wihtouth_posix &lt;-<span class="st"> </span>cos_data[ ,chosen_cols]
    data_wihtouth_posix[rows_with_na] &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;missing_data&quot;</span>)
    colmax &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dt">X =</span> data_wihtouth_posix, <span class="dt">FUN =</span> max)
    <span class="co">#</span>
    <span class="co"># if there are columns withouth observations remove them from the data:</span>
    if ( <span class="kw">any</span>(colmax &lt;<span class="st"> </span><span class="fl">0.0</span>) ){
      name_o &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_o&quot;</span>)
      neg_o_names &lt;-<span class="st"> </span><span class="kw">which</span>(colmax &lt;<span class="st"> </span><span class="fl">0.0</span>) %&gt;%
<span class="st">        </span>names
      neg_s_names &lt;-<span class="st"> </span><span class="kw">gsub</span>(name_o,<span class="kw">viscos_options</span>(<span class="st">&quot;name_s&quot;</span>),neg_o_names,<span class="dt">ignore.case =</span> <span class="ot">TRUE</span> )
      data_selection &lt;-<span class="st"> </span>neg_o_names %|%<span class="st"> </span>neg_s_names %&gt;%
<span class="st">        </span><span class="kw">paste</span>(.,<span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">        </span><span class="kw">grepl</span>(., <span class="kw">names</span>(cos_data), <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">        </span><span class="kw">not</span>(.)
      data_only_observed &lt;-<span class="st"> </span>cos_data[ ,data_selection]

    } else {
      data_only_observed &lt;-<span class="st"> </span>cos_data
    }
    <span class="co"># set all missing data values to NA for use in hydroGOF</span>
    idx_NA &lt;-<span class="st"> </span>data_only_observed %&gt;%
<span class="st">      </span><span class="kw">equals</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;missing_data&quot;</span>))
    data_only_observed[idx_NA] &lt;-<span class="st"> </span><span class="ot">NA</span>
    <span class="kw">return</span>(data_only_observed)
  }</code></pre></div>
</div>
</div>
<div id="complete-the-date-formats" class="section level3">
<h3><span class="header-section-number">1.4.3</span> Complete the date formats</h3>
<p>This function is not finished yet! Within cos_data data.frame (see: <a href="Introduction.html">introduction</a>) the date has to be defined in two formats: With 5 columns, where the columns are year-month-day-hour-minute and names as defined in <code>viscos_options()</code> and with one column in <code>POSIXct</code> format (see: <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html">link</a>), that is named as defined in <code>viscos_options(&quot;name_COSposix&quot;)</code>. The idea of the <code>complete_dates</code> fucntion is to provide a internal posibility to create the one format out of the ohter and thus <em>complete the dates</em>.</p>
<p><strong>However</strong>, currently it is only possible to convert the 5-columns representation into <code>POSIXct</code> dates via the internally defined <code>implode_cosdate</code> function.</p>
<p>Also by using <em>UTC</em> a <strong>fixed time-zone</strong> is assumed within visCOS to avoid problems with leaps in time (summer/winter time).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Complete the date-formats with POSIXct or COSdate</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Complete the data-formats of your data.frame `POSIXct` and/or `COSdate`</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data The data.frame, which contains the runoff information</span>
  <span class="co">#&#39; @param name_cosyear string with the name of the `COSdate` year column</span>
  <span class="co">#&#39; @param name_posix string with the name of the POSIXct column</span>
  <span class="co">#&#39; @return The new runoff data.frame with the added data-format.</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @export</span>
complete_dates &lt;-<span class="st"> </span>function(cos_data) {
  <span class="co"># make sure that magrittr is loaded:</span>
  <span class="kw">assert_dataframe</span>(cos_data)
  <span class="co"># check for COSdates and stop if non-logical expression are obtained</span>
  OK_COSdate &lt;-<span class="st"> </span><span class="kw">any</span>(
    <span class="kw">unlist</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>,
                          <span class="st">&quot;name_COSmonth&quot;</span>,
                          <span class="st">&quot;name_COSmonth&quot;</span>,
                          <span class="st">&quot;name_COShour&quot;</span>,
                          <span class="st">&quot;name_COSmin&quot;</span>)
                           )
    %in%
<span class="st">    </span><span class="kw">names</span>(cos_data)
  )
  OK_POSIXdates &lt;-<span class="st"> </span><span class="kw">any</span>(<span class="kw">names</span>(cos_data) ==<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>))
  if ( !<span class="kw">is.logical</span>(OK_COSdate) |<span class="st"> </span>!<span class="kw">is.logical</span>(OK_POSIXdates) ) {
    <span class="kw">stop</span>(<span class="st">&quot;Something is wrong :( </span><span class="ch">\n</span>
<span class="st">         some of the date-columns could not be processed!&quot;</span>)
  }
  <span class="co"># choose function depending on which formats are available!</span>
  if (!OK_COSdate &amp;<span class="st"> </span>!OK_POSIXdates) {
    <span class="kw">stop</span>(<span class="st">&quot;Something is wrong :( </span><span class="ch">\n</span>
<span class="st">         The 5 cosero date columns and the POSIXct colum could not be found&quot;</span>)
  } else if (OK_COSdate &amp;<span class="st"> </span>!OK_POSIXdates) {
    cos_data &lt;-<span class="st"> </span><span class="kw">implode_cosdate</span>(cos_data) <span class="co"># see following chapter</span>
  } else if (!OK_COSdate &amp;<span class="st"> </span>OK_POSIXdates) {
    <span class="kw">stop</span>(<span class="st">&quot;POSIXct to COSdates not yet supported :(&quot;</span>)
  }
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
<div id="implode-cosdate" class="section level4">
<h4><span class="header-section-number">1.4.3.1</span> Implode cosdate</h4>
<p>This function is used to transform the “old-school” 5 column format into the widely spread POSIXct format. The function is not exported and should only be called from within <code>complete_date()</code>!. Also, thanks to Christoph Schürz for his help with conception.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">implode_cosdate &lt;-<span class="st"> </span>function(cos_data) {
  <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
  <span class="kw">assert_dataframe</span>(cos_data)
  name_string &lt;-<span class="st">  </span>cos_data %&gt;%<span class="st"> </span>names %&gt;%<span class="st"> </span>tolower
  <span class="co">#</span>
  POSIXdate &lt;-<span class="st"> </span><span class="kw">paste</span>(cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]],
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSday&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COShour&quot;</span>)]]),
                     <span class="kw">sprintf</span>(<span class="st">&quot;%02d&quot;</span>,cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmin&quot;</span>)]]),
                     <span class="dt">sep=</span> <span class="st">&quot;&quot;</span> ) %&gt;%
<span class="st">    </span><span class="kw">as.POSIXct</span>(<span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>, <span class="dt">origin =</span> .[<span class="dv">1</span>], <span class="dt">scale =</span> <span class="st">&quot;hourly&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;UTC&quot;</span>)
  cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>)]] &lt;-<span class="st"> </span>POSIXdate
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
</div>
</div>
<div id="remove-leading-zeros-in-column-names" class="section level3">
<h3><span class="header-section-number">1.4.4</span> Remove leading zeros in column names</h3>
<p>This internal function removes leading zeros from column names of the <code>cos_data</code> data.frame. The function has no defensive code but uses <code>remove_junk</code> (see: above). It should therefore be used with care!</p>
<p><strong>Sad Note:</strong> The current solution is bit suboptimal as many operations are needed and different tricks are used (e.g. <code>as.numeric %&gt;% as.character</code>) to obtain the wanted result. We hope that better solutions can be found in the future.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># remove leading zeros from the names of cos_data (data.frame)</span>
remove_leading_zeros &lt;-<span class="st"> </span>function(cos_data) {
  <span class="kw">require</span>(<span class="st">&quot;magrittr&quot;</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)
  cos_data %&lt;&gt;%<span class="st"> </span>remove_junk
  <span class="co">#</span>
  runoff_names &lt;-<span class="st"> </span>cos_data %&gt;%<span class="st"> </span>names
  runoff_lowercase_names &lt;-<span class="st"> </span>runoff_names %&gt;%<span class="st"> </span>tolower
  <span class="co">#</span>
  separator &lt;-<span class="st"> </span>runoff_lowercase_names %&gt;%
<span class="st">    </span><span class="kw">extract</span>( <span class="kw">grep</span>(<span class="kw">viscos_options</span>()$name_o,.) ) %&gt;%
<span class="st">    </span><span class="kw">extract</span>( <span class="dv">1</span> ) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="kw">viscos_options</span>()$name_o,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>,<span class="st">&quot;&quot;</span>,.)
  searchterm &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">viscos_options</span>()$name_o,<span class="st">&quot;|&quot;</span>, <span class="kw">viscos_options</span>()$name_s)
  runoff_nums &lt;-<span class="st"> </span>runoff_lowercase_names %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(searchterm,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(separator,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">D&quot;</span>,<span class="st">&quot;&quot;</span>,.)
  searchterm &lt;-<span class="st"> </span><span class="kw">paste</span>(runoff_nums, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
  runoff_only_names &lt;-<span class="st"> </span>runoff_names %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="kw">paste0</span>(<span class="st">&quot;[&quot;</span>,searchterm,<span class="st">&quot;]&quot;</span>),<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(separator,<span class="st">&quot;&quot;</span>,.)
  runoff_new_numbers &lt;-<span class="st"> </span>runoff_nums %&gt;%
<span class="st">    </span><span class="kw">as.numeric</span>() %&gt;%
<span class="st">    </span><span class="kw">as.character</span>()
  runoff_new_numbers[<span class="kw">is.na</span>(runoff_new_numbers)] &lt;-<span class="st"> &quot;&quot;</span>
  <span class="co">#</span>
  <span class="kw">names</span>(cos_data) &lt;-<span class="st"> </span>runoff_new_numbers %&gt;%
<span class="st">    </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d+&quot;</span>,separator,.) %&gt;%
<span class="st">    </span><span class="kw">paste0</span>(runoff_only_names,.,runoff_new_numbers)
  <span class="kw">return</span>(cos_data)
}</code></pre></div>
</div>
<div id="mark-the-needed-periods" class="section level3">
<h3><span class="header-section-number">1.4.5</span> Mark the needed periods</h3>
<p>This function can be used to create a <code>viscos_options(&quot;name_COSperiod&quot;)</code>. The period column is a vector of increasing integer that is set to 0 for rows that are out of the period.</p>
<p>The current solution for defining this columns is not realy satisfying, but the problem seems to be non-trival… Life is short and it was the best that the authors could come out with so far.</p>
<p>In its current iteration the function takes <code>cos_data</code> and the two integers <code>start_month</code> and <code>end_month</code> as inputs, that can be used to define the to-be marked periods. The function can be directly used on raw data since the <code>remove_junk</code> and <code>complete_dates</code> are internaly applied to. This does however also mean that it needs to be used with care!</p>
<p>The computation is done in the following way: (I) Before starting the acutal marking the variable <code>period_range</code> and the <code>out_of_period</code> vector is defined. (II) With the help of the vectors the periods can be marked in two steps:</p>
<ul>
<li>First, all the starting months within cos_data are marked and the cumulative sum is used to count the periods within the data.frame. At the beginning of the first period, the counter is at “1” and becomes “2” with the beginning of the second period and so on.</li>
<li>Secondly, the <code>out_of_period</code> of all years is set back to zero again by checking which months of the data are equal to the <code>out_of_period</code> entries.</li>
</ul>
<p>There are at least two apparent problems with that solution:</p>
<ul>
<li>One problem is that the last year is not extracted properly if <code>start_month</code> &gt; <code>end_month</code>. To compensate this problem the <code>dplyr</code> shenanigans are added at the end of the fucntion.</li>
<li>The other problem is that that the first and last period are also included in the solution even if they are <strong>not</strong> complete!</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; calculate periods</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Mark the periods within cos_data.</span>
  <span class="co"># The marking uses a monthly resolution, which are defined by the integers</span>
  <span class="co">#&#39; `start_month` and `end_month`.  </span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data The data.frame, which contains the runoff information</span>
  <span class="co">#&#39; @return The runoff data.frame reduced and ordered according to the</span>
  <span class="co">#&#39; hydrological years within the data.</span>
  <span class="co">#&#39; \strong{Note:} The periods columns are formatted as characters!</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import dplyr</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @export</span>
mark_periods &lt;-<span class="st"> </span>function(cos_data, <span class="dt">start_month =</span> <span class="dv">10</span>, <span class="dt">end_month =</span> <span class="dv">9</span>) {
  <span class="kw">assert_dataframe</span>(cos_data)
  cos_data %&lt;&gt;%<span class="st"> </span>remove_junk %&gt;%<span class="st"> </span><span class="kw">complete_dates</span>()
  <span class="co"># (I) get labels for the months</span>
  if (start_month &lt;=<span class="st"> </span>end_month ) {
    period_range &lt;-<span class="st"> </span><span class="kw">seq</span>(start_month,end_month)
    out_of_period &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %&gt;%<span class="st"> </span><span class="kw">extract</span>( !(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %in%<span class="st"> </span>period_range) )
  } else if (start_month &gt;<span class="st"> </span>end_month) {
    range_1 &lt;-<span class="st"> </span><span class="kw">seq</span>(start_month,<span class="dv">12</span>)
    range_2 &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,end_month)
    period_range &lt;-<span class="st"> </span><span class="kw">c</span>(range_1,range_2)
    out_of_period &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %&gt;%<span class="st"> </span><span class="kw">extract</span>( !(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">12</span>) %in%<span class="st"> </span>period_range) )
  }

  <span class="co"># (II) mark periods:</span>
    eval_diff &lt;-<span class="st"> </span>function(a) {<span class="kw">c</span>(a[<span class="dv">1</span>],<span class="kw">diff</span>(a))}
    cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSperiod&quot;</span>)]] &lt;-
<span class="st">      </span>cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] %in%<span class="st"> </span><span class="kw">c</span>(start_month) %&gt;%
<span class="st">      </span>eval_diff %&gt;%
<span class="st">      </span><span class="kw">pmax</span>(.,<span class="dv">0</span>) %&gt;%
<span class="st">      </span>cumsum
    cos_data$period[cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] %in%<span class="st"> </span>out_of_period] &lt;-<span class="st"> </span><span class="dv">0</span>
    <span class="co"># corrections for last year</span>
    max_year &lt;-<span class="st"> </span><span class="kw">max</span>(cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]])
    cos_data %&lt;&gt;%<span class="st"> </span>dplyr::<span class="kw">mutate</span>(
      <span class="dt">period =</span> <span class="kw">ifelse</span>(
        (  (.[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSyear&quot;</span>)]] ==<span class="st"> </span>max_year) &amp;
<span class="st">           </span>(.[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSmonth&quot;</span>)]] &gt;<span class="st"> </span>end_month)  ),
                      <span class="dv">0</span>,
                      period
        )
      )
    <span class="kw">return</span>(cos_data)
}</code></pre></div>
<p>Here are two additonal examples that display the slected periods and the numbering:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(magrittr)
<span class="kw">require</span>(visCOS)
<span class="co"># mark_periods example 1: Hydrological years (September till August)</span>
<span class="co"># note that the last year is not complete, so the counter jumps back to 0</span>
ex1 &lt;-<span class="st"> </span><span class="kw">get_cos_data_example</span>() %&gt;%<span class="st"> </span><span class="kw">mark_periods</span>(.,<span class="dt">start_month =</span> <span class="dv">9</span>, <span class="dt">end_month =</span> <span class="dv">8</span>)
<span class="kw">plot</span>(ex1$period, <span class="dt">xlab=</span><span class="st">&quot;Timestep&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;# of hydrological year&quot;</span>)</code></pre></div>
<p><img src="visdoc_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mark_periods example 2: Summer Months (June till August)</span>
ex2 &lt;-<span class="st"> </span><span class="kw">get_cos_data_example</span>() %&gt;%<span class="st"> </span><span class="kw">mark_periods</span>(.,<span class="dt">start_month =</span> <span class="dv">6</span>, <span class="dt">end_month =</span> <span class="dv">8</span>)
<span class="kw">plot</span>(ex2$period, <span class="dt">xlab=</span><span class="st">&quot;Timestep&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;# year of summer months&quot;</span>)</code></pre></div>
<p><img src="visdoc_files/figure-html/unnamed-chunk-13-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="transform-the-cos_data-into-xts" class="section level3">
<h3><span class="header-section-number">1.4.6</span> Transform the <code>cos_data</code> into <code>xts</code></h3>
<p>This function is actually just a small wrapper around the <code>xts::xts</code> function for the purposes of <strong>visCOS</strong>.</p>
<p>A notable quirk of the function is that the names of the header are put to lower cases via the <code>tolower</code> function and possible leading zeros in the enumeration of the basins are removed.</p>
<p>Currently it is not exported as users can use <code>xts</code> themselves perfectly well, and it is felt that the function does not provide enough added value for the user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; Convert cos_data to xts-format</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Converts the cos_data (class: data_frame) into an xts object</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param cos_data data_frame of the cos_data (see: xxx)</span>
  <span class="co">#&#39; @return xts object of the cos_data data.frame</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import zoo</span>
  <span class="co">#&#39; @importFrom xts xts</span>
  <span class="co">#&#39; @import magrittr</span>
cos_data_as_xts &lt;-<span class="st"> </span>function(cos_data) {
  <span class="co"># pre</span>
  <span class="kw">assert_dataframe</span>(cos_data)
  <span class="kw">assert_junk</span>(cos_data)
  <span class="kw">assert_complete_date</span>(cos_data)
  <span class="co"># everything is set to lower case</span>
  cos_data &lt;-<span class="st"> </span><span class="kw">remove_leading_zeros</span>(cos_data) %&gt;%
<span class="st">    </span>magrittr::<span class="kw">set_names</span>(<span class="kw">names</span>(cos_data) %&gt;%<span class="st"> </span>tolower)
  name_posix &lt;-<span class="st"> </span><span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>) %&gt;%<span class="st"> </span>tolower
  cos_data_as_xts &lt;-<span class="st"> </span><span class="kw">xts</span>(<span class="dt">x =</span> cos_data[], <span class="co"># ,names(cos_data) != name_posix</span>
                            <span class="dt">order.by =</span> cos_data[[name_posix]])
  <span class="co">#</span>
  <span class="kw">return</span>(cos_data_as_xts)
}</code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="options.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["visdoc.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
