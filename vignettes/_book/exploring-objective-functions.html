<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>visCOS: documentation</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="visCOS: documentation">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="visCOS: documentation" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="visCOS: documentation" />
  
  
  

<meta name="author" content="Daniel Klotz, Johannes Wesemann, Mathew Herrnegger">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="plotting-runoff-peaks-plots.html">
<link rel="next" href="generate-previews.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">visCOS: documentation</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Hello, traveler</a></li>
<li class="chapter" data-level="1" data-path="cooking-data.html"><a href="cooking-data.html"><i class="fa fa-check"></i><b>1</b> Cooking Data</a><ul>
<li class="chapter" data-level="1.1" data-path="cooking-data.html"><a href="cooking-data.html#raw-data"><i class="fa fa-check"></i><b>1.1</b> Raw Data</a></li>
<li class="chapter" data-level="1.2" data-path="cooking-data.html"><a href="cooking-data.html#cooked-data"><i class="fa fa-check"></i><b>1.2</b> Cooked Data</a></li>
<li class="chapter" data-level="1.3" data-path="cooking-data.html"><a href="cooking-data.html#examples"><i class="fa fa-check"></i><b>1.3</b> Examples</a></li>
<li class="chapter" data-level="1.4" data-path="cooking-data.html"><a href="cooking-data.html#code"><i class="fa fa-check"></i><b>1.4</b> Code</a><ul>
<li class="chapter" data-level="1.4.1" data-path="cooking-data.html"><a href="cooking-data.html#get-example-data"><i class="fa fa-check"></i><b>1.4.1</b> Get Example Data</a></li>
<li class="chapter" data-level="1.4.2" data-path="cooking-data.html"><a href="cooking-data.html#remove-not-needed-columns"><i class="fa fa-check"></i><b>1.4.2</b> Remove not needed columns</a></li>
<li class="chapter" data-level="1.4.3" data-path="cooking-data.html"><a href="cooking-data.html#complete-the-date-formats"><i class="fa fa-check"></i><b>1.4.3</b> Complete the date formats</a></li>
<li class="chapter" data-level="1.4.4" data-path="cooking-data.html"><a href="cooking-data.html#remove-leading-zeros-in-column-names"><i class="fa fa-check"></i><b>1.4.4</b> Remove leading zeros in column names</a></li>
<li class="chapter" data-level="1.4.5" data-path="cooking-data.html"><a href="cooking-data.html#mark-the-needed-periods"><i class="fa fa-check"></i><b>1.4.5</b> Mark the needed periods</a></li>
<li class="chapter" data-level="1.4.6" data-path="cooking-data.html"><a href="cooking-data.html#transform-the-cos_data-into-xts"><i class="fa fa-check"></i><b>1.4.6</b> Transform the <code>cos_data</code> into <code>xts</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="options.html"><a href="options.html"><i class="fa fa-check"></i><b>2</b> Options</a></li>
<li class="chapter" data-level="3" data-path="ojective-functions.html"><a href="ojective-functions.html"><i class="fa fa-check"></i><b>3</b> Ojective Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="ojective-functions.html"><a href="ojective-functions.html#code-1"><i class="fa fa-check"></i><b>3.1</b> Code</a><ul>
<li class="chapter" data-level="3.1.1" data-path="ojective-functions.html"><a href="ojective-functions.html#the-main-objective-functions"><i class="fa fa-check"></i><b>3.1.1</b> The “Main” Objective Functions</a></li>
<li class="chapter" data-level="3.1.2" data-path="ojective-functions.html"><a href="ojective-functions.html#ohter-objective-functions"><i class="fa fa-check"></i><b>3.1.2</b> Ohter Objective Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ojective-functions.html"><a href="ojective-functions.html#references"><i class="fa fa-check"></i><b>3.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="time-aggregates.html"><a href="time-aggregates.html"><i class="fa fa-check"></i><b>4</b> Time Aggregates</a><ul>
<li class="chapter" data-level="4.1" data-path="time-aggregates.html"><a href="time-aggregates.html#examples-1"><i class="fa fa-check"></i><b>4.1</b> Examples</a></li>
<li class="chapter" data-level="4.2" data-path="time-aggregates.html"><a href="time-aggregates.html#code-2"><i class="fa fa-check"></i><b>4.2</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html"><i class="fa fa-check"></i><b>5</b> Summaries of important objective functions</a><ul>
<li class="chapter" data-level="5.1" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#code-3"><i class="fa fa-check"></i><b>5.1</b> Code</a><ul>
<li class="chapter" data-level="5.1.1" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#compute-the-main-objective-functions"><i class="fa fa-check"></i><b>5.1.1</b> Compute the Main Objective Functions</a></li>
<li class="chapter" data-level="5.1.2" data-path="summaries-of-important-objective-functions.html"><a href="summaries-of-important-objective-functions.html#plotting"><i class="fa fa-check"></i><b>5.1.2</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html"><i class="fa fa-check"></i><b>6</b> Flow Duration Curves</a><ul>
<li class="chapter" data-level="6.1" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#example"><i class="fa fa-check"></i><b>6.1</b> Example</a></li>
<li class="chapter" data-level="6.2" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#code-4"><i class="fa fa-check"></i><b>6.2</b> Code</a><ul>
<li class="chapter" data-level="6.2.1" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#computing-the-data-for-the-flow-duration-curves"><i class="fa fa-check"></i><b>6.2.1</b> Computing the data for the flow duration curves</a></li>
<li class="chapter" data-level="6.2.2" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#plotting-the-flow-duration-curves"><i class="fa fa-check"></i><b>6.2.2</b> Plotting the Flow duration curves</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="flow-duration-curves.html"><a href="flow-duration-curves.html#references-1"><i class="fa fa-check"></i><b>6.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html"><i class="fa fa-check"></i><b>7</b> Plotting Runoff Peaks Plots</a><ul>
<li class="chapter" data-level="7.1" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#examples-2"><i class="fa fa-check"></i><b>7.1</b> Examples:</a></li>
<li class="chapter" data-level="7.2" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#code-5"><i class="fa fa-check"></i><b>7.2</b> Code</a><ul>
<li class="chapter" data-level="7.2.1" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#generating-the-plots-for-one-basin."><i class="fa fa-check"></i><b>7.2.1</b> Generating the Plots for one basin.</a></li>
<li class="chapter" data-level="7.2.2" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#function-to-find-peaks"><i class="fa fa-check"></i><b>7.2.2</b> Function to find peaks</a></li>
<li class="chapter" data-level="7.2.3" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#subplot-function"><i class="fa fa-check"></i><b>7.2.3</b> Subplot Function</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="plotting-runoff-peaks-plots.html"><a href="plotting-runoff-peaks-plots.html#references-2"><i class="fa fa-check"></i><b>7.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html"><i class="fa fa-check"></i><b>8</b> Exploring Objective Functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#example-1"><i class="fa fa-check"></i><b>8.1</b> Example</a></li>
<li class="chapter" data-level="8.2" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#code-6"><i class="fa fa-check"></i><b>8.2</b> Code</a><ul>
<li class="chapter" data-level="8.2.1" data-path="exploring-objective-functions.html"><a href="exploring-objective-functions.html#explore-the-data"><i class="fa fa-check"></i><b>8.2.1</b> Explore the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="generate-previews.html"><a href="generate-previews.html"><i class="fa fa-check"></i><b>9</b> Generate Previews</a><ul>
<li class="chapter" data-level="9.1" data-path="generate-previews.html"><a href="generate-previews.html#code-7"><i class="fa fa-check"></i><b>9.1</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="defensive-code.html"><a href="defensive-code.html"><i class="fa fa-check"></i><b>10</b> Defensive Code</a><ul>
<li class="chapter" data-level="10.1" data-path="defensive-code.html"><a href="defensive-code.html#code-8"><i class="fa fa-check"></i><b>10.1</b> Code</a><ul>
<li class="chapter" data-level="10.1.1" data-path="defensive-code.html"><a href="defensive-code.html#check-if-cos_data-is-clean"><i class="fa fa-check"></i><b>10.1.1</b> Check if <code>cos_data</code> is “clean”</a></li>
<li class="chapter" data-level="10.1.2" data-path="defensive-code.html"><a href="defensive-code.html#check-date-completeness"><i class="fa fa-check"></i><b>10.1.2</b> Check date completeness</a></li>
<li class="chapter" data-level="10.1.3" data-path="defensive-code.html"><a href="defensive-code.html#check-if-the-data-is-a-data.frame"><i class="fa fa-check"></i><b>10.1.3</b> Check if the data is a <code>data.frame</code></a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="defensive-code.html"><a href="defensive-code.html#references-3"><i class="fa fa-check"></i><b>10.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="helpers.html"><a href="helpers.html"><i class="fa fa-check"></i><b>11</b> Helpers</a><ul>
<li class="chapter" data-level="11.1" data-path="helpers.html"><a href="helpers.html#code-9"><i class="fa fa-check"></i><b>11.1</b> Code</a><ul>
<li class="chapter" data-level="11.1.1" data-path="helpers.html"><a href="helpers.html#get-a-regular-expression-string-for-the-needed-columns"><i class="fa fa-check"></i><b>11.1.1</b> Get a Regular Expression String for the needed columns</a></li>
<li class="chapter" data-level="11.1.2" data-path="helpers.html"><a href="helpers.html#extract-the-numeration-of-the-basins"><i class="fa fa-check"></i><b>11.1.2</b> Extract the numeration of the basins</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">visCOS: documentation</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploring-objective-functions" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Exploring Objective Functions</h1>
<p>This section defines the code of a <a href="http://shiny.rstudio.com/">shiny gadget</a>. It enables the interactive exploration of (hydro-) graphs for the different basins. The gadget shows always the corresponding objective function for the selected graph. Furthermore, one can get the selected data by clicking on “done” at the end of a session. The following examples provide a good overview of what the function can do.</p>
<div id="example-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Example</h2>
<p>This chapter gives examples of <code>explore_cos_data</code>. For the pre-requirements take a look at the <a href="LP-Introduction">introduction</a>. Running the <code>explore_cos_data</code> function without any options opens a shiny gadget in the viewer:</p>
<p><img src="figures/explore_cos_data.gif" style="display: block; margin: auto;" /></p>
<p>Information on the <em>objective functions</em> can be found <a href="ex-OF_explanation.html">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">viscos_options</span>(<span class="dt">color_o =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">color_s =</span> <span class="st">&quot;red&quot;</span>)
<span class="kw">explore_cos_data</span>(runoff_example)</code></pre></div>
<p>Users can select different basins via the selection box (<em># basins:</em>) on the top-left and interactively zoom and move the graph in the center by clicking on it or moving the date switches below the graph. While doing so the objective functions (presented in the table below) are re-calculated for the chosen time window.</p>
</div>
<div id="code-6" class="section level2">
<h2><span class="header-section-number">8.2</span> Code</h2>
<p>In the following paragraphs the code of the shiny app is defined. The computations of the app are defined in the <code>server</code> part and the appearance in the <code>ui</code>.</p>
<div id="explore-the-data" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Explore the data</h3>
<p>This function represents the main part of the shiny app. The current solution <strong>forces</strong> users to enumerate their basins with and the shiny app needs some pre-calculation, which need to be calculated before the app is started. These calculations are made before the app as such is defined. They include:</p>
<ul>
<li><ol style="list-style-type: upper-roman">
<li>Defensive code</li>
</ol></li>
<li><ol start="2" style="list-style-type: upper-roman">
<li>Transform data into <code>xts</code> (<code>d_xts</code>).</li>
</ol></li>
<li><ol start="3" style="list-style-type: upper-roman">
<li>Save numeration of basins within the variable <code>d_nums</code>.</li>
</ol></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#&#39; explore cos_data with Objective Functions</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; Runs a Shiny App which can be used to get an overview of a cos_data time</span>
  <span class="co">#&#39; series object.</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @param d_xts cos_data formatted as time series</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @import shiny</span>
  <span class="co">#&#39; @import miniUI</span>
  <span class="co">#&#39; @importFrom xts xts</span>
  <span class="co">#&#39; @import dplyr</span>
  <span class="co">#&#39; @import magrittr</span>
  <span class="co">#&#39; @import dygraphs</span>
  <span class="co">#&#39; @import hydroGOF</span>
  <span class="co">#&#39; @import pasta</span>
  <span class="co">#&#39; @importFrom purrr map_df</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @export</span>
  <span class="co">#&#39;</span>
  <span class="co">#&#39; @examples</span>
  <span class="co">#&#39; # get example data,</span>
  <span class="co">#&#39; # explore the model performance</span>
  <span class="co">#&#39; cos_data &lt;- get_viscos_example()</span>
  <span class="co">#&#39; explore_cos_data(cos_data)</span>
explore_cos_data &lt;-<span class="st"> </span>function(cos_data,
                                   <span class="dt">of_list =</span> <span class="kw">list</span>(
                                     <span class="dt">nse =</span> of_nse,
                                     <span class="dt">kge =</span> of_kge,
                                     <span class="dt">p_bias =</span> of_p_bias,
                                     <span class="dt">r =</span> of_cor
                                   ),
                                   <span class="dt">start_date =</span> <span class="ot">NULL</span>,
                                   <span class="dt">end_date =</span> <span class="ot">NULL</span>) {
  <span class="co"># pre-sets</span>
  <span class="co"># (I) Defense</span>
  if (<span class="kw">is.null</span>(<span class="kw">names</span>(of_list))){
    <span class="kw">names</span>(of_list) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;of&quot;</span>, <span class="dv">1</span>:<span class="kw">length</span>(of_list), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)
  }
  clean_cos_data &lt;-<span class="st"> </span>cos_data %&gt;%<span class="st"> </span>remove_leading_zeros
  if ( !<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>) %in%<span class="st"> </span><span class="kw">names</span>(clean_cos_data) ) {
    clean_cos_data %&lt;&gt;%<span class="st"> </span>complete_dates
  }
  <span class="co"># (II)</span>
  d_xts &lt;-<span class="st"> </span><span class="kw">cos_data_as_xts</span>(clean_cos_data)
  <span class="co"># (III)</span>
  idx_names &lt;-<span class="st"> </span><span class="kw">names</span>(d_xts) %&gt;%
<span class="st">    </span>tolower %&gt;%
<span class="st">    </span><span class="kw">grepl</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;name_o&quot;</span>),.)
  d_nums &lt;-<span class="st"> </span>d_xts %&gt;%
<span class="st">      </span><span class="kw">names</span>() %&gt;%
<span class="st">      </span>.[idx_names] %&gt;%
<span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">D&quot;</span>,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">      </span>as.integer %&gt;%
<span class="st">      </span>unique</code></pre></div>
<p>The server-side of the shiny app is rather lengthy but not too difficult. The major readability problems occur because of the unusual formatting enforced by shinyApps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  server &lt;-<span class="st"> </span>function(input, output, session) {
    <span class="co"># (I) get strings used in the naming of clean_cos_data:</span>
    unique_data_names &lt;-<span class="st"> </span><span class="kw">names</span>(clean_cos_data) %&gt;%
<span class="st">      </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>,<span class="st">&quot;&quot;</span>,.) %&gt;%
<span class="st">      </span>tolower %&gt;%
<span class="st">      </span>unique
    x_string &lt;-<span class="st"> </span>unique_data_names[ unique_data_names %&gt;%
<span class="st">                                     </span><span class="kw">grep</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;name_o&quot;</span>),.) ]
    y_string &lt;-<span class="st"> </span>unique_data_names[ unique_data_names  %&gt;%
<span class="st">                                     </span><span class="kw">grep</span>(<span class="kw">viscos_options</span>(<span class="st">&quot;name_s&quot;</span>),.) ]
    <span class="co"># (II) select data:</span>
    selector_x &lt;-<span class="st"> </span><span class="kw">reactive</span>({ x_string %&amp;%<span class="st"> </span>input$basin_num %&amp;%<span class="st"> &quot;$&quot;</span> }) <span class="co"># &quot;$&quot; terminates the searchstring; see regex</span>
    selector_y &lt;-<span class="st"> </span><span class="kw">reactive</span>({ y_string %&amp;%<span class="st"> </span>input$basin_num %&amp;%<span class="st"> &quot;$&quot;</span> })
    selected_data &lt;-<span class="st"> </span><span class="kw">reactive</span>({
      <span class="kw">select</span>(clean_cos_data,
             <span class="kw">matches</span>( <span class="kw">selector_x</span>() ),
             <span class="kw">matches</span>( <span class="kw">selector_y</span>() )
             ) %&gt;%
<span class="st">        </span><span class="kw">select</span>(<span class="dt">x =</span> <span class="kw">matches</span>( <span class="kw">selector_x</span>() ),
               <span class="dt">y =</span> <span class="kw">matches</span>( <span class="kw">selector_y</span>() ))
    })
    <span class="co"># (III) create xts-formated table for use in dygraphs:</span>
    xts_selected_data &lt;-<span class="st"> </span><span class="kw">reactive</span> ({
      <span class="kw">xts</span>(<span class="kw">selected_data</span>(),
          <span class="dt">order.by =</span> clean_cos_data[[<span class="kw">viscos_options</span>(<span class="st">&quot;name_COSposix&quot;</span>)]])
    })
    <span class="co"># (IV) create plots:</span>
    output$hydrographs &lt;-<span class="st"> </span><span class="kw">renderDygraph</span>({
      <span class="kw">dygraph</span>( <span class="kw">xts_selected_data</span>() ) %&gt;%
<span class="st">        </span><span class="kw">dyAxis</span>(<span class="st">&quot;y&quot;</span>,
               <span class="dt">label =</span> visCOS::<span class="kw">viscos_options</span>(<span class="st">&quot;data_unit&quot;</span>)) %&gt;%
<span class="st">        </span><span class="kw">dySeries</span>(<span class="st">&quot;x&quot;</span>,
                 <span class="dt">label =</span> visCOS::<span class="kw">viscos_options</span>(<span class="st">&quot;name_o&quot;</span>),
                 <span class="dt">color =</span> <span class="kw">viscos_options</span>(<span class="st">&quot;color_o&quot;</span>)) %&gt;%
<span class="st">        </span><span class="kw">dySeries</span>(<span class="st">&quot;y&quot;</span>,
                 <span class="dt">label =</span> visCOS::<span class="kw">viscos_options</span>(<span class="st">&quot;name_s&quot;</span>),
                 <span class="dt">color =</span> <span class="kw">viscos_options</span>(<span class="st">&quot;color_s&quot;</span>)) %&gt;%
<span class="st">        </span><span class="kw">dyRangeSelector</span>(<span class="dt">height =</span> <span class="dv">20</span>, <span class="dt">strokeColor =</span> <span class="st">&quot;&quot;</span>) %&gt;%
<span class="st">        </span><span class="kw">dyCrosshair</span>(<span class="dt">direction =</span> <span class="st">&quot;vertical&quot;</span>) %&gt;%
<span class="st">         </span><span class="kw">dyOptions</span>(<span class="dt">includeZero =</span> <span class="ot">TRUE</span>, <span class="dt">retainDateWindow =</span> <span class="ot">TRUE</span>)
    })
    <span class="co"># (IV) get dygraph date bounds (switches):</span>
    selcted_from &lt;-<span class="st"> </span><span class="kw">reactive</span>({
      if (!<span class="kw">is.null</span>(start_date)) {
        start_date
      } else if (!<span class="kw">is.null</span>(input$hydrographs_date_window)) {
        input$hydrographs_date_window[[<span class="dv">1</span>]]
      }
    })
    selcted_to &lt;-<span class="st"> </span><span class="kw">reactive</span>({
      if (!<span class="kw">is.null</span>(end_date)) {
        end_date
      } else if (!<span class="kw">is.null</span>(input$hydrographs_date_window)) {
        input$hydrographs_date_window[[<span class="dv">2</span>]]
      }

    })
    <span class="co"># (V) extract time_window for the stats header:</span>
    output$selected_timewindow &lt;-<span class="st"> </span><span class="kw">renderText</span>({
      if (!<span class="kw">is.null</span>(input$hydrographs_date_window))
        <span class="kw">paste</span>(<span class="kw">strftime</span>(<span class="kw">selcted_from</span>(), <span class="dt">format =</span> <span class="st">&quot;%d %b %Y&quot;</span>),
              <span class="st">&quot;-&quot;</span>,
              <span class="kw">strftime</span>(<span class="kw">selcted_to</span>(), <span class="dt">format =</span> <span class="st">&quot;%d %b %Y&quot;</span>),
              <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)
    })
    <span class="co"># (VI) calculate stats:</span>
    sub_slctd &lt;-<span class="st"> </span><span class="kw">reactive</span>({
      if (!<span class="kw">is.null</span>(input$hydrographs_date_window))
        <span class="kw">xts_selected_data</span>()[<span class="kw">paste</span>(<span class="kw">strftime</span>(<span class="kw">selcted_from</span>(), <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d-%H-%M&quot;</span>),
                               <span class="kw">strftime</span>(<span class="kw">selcted_to</span>(), <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d-%H-%M&quot;</span>),
                               <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)]
    })
    out_of &lt;-<span class="st"> </span><span class="kw">reactive</span>({
      if (!<span class="kw">is.null</span>(input$hydrographs_date_window)) {
          <span class="kw">map_df</span>(of_list, function(of_,x,y) <span class="kw">of_</span>(x,y),
                 <span class="dt">x =</span> <span class="kw">sub_slctd</span>()$x,
                 <span class="dt">y =</span> <span class="kw">sub_slctd</span>()$y ) <span class="co">#serve_of( sub_slctd()$x,sub_slctd()$y )</span>
      }
    })

    output$slctd_OF &lt;-<span class="st"> </span><span class="kw">renderTable</span>(<span class="kw">out_of</span>())
    <span class="co"># (VII) exit when user clicks on done</span>
     <span class="co"># When the Done button is clicked, return a value</span>
    <span class="kw">observeEvent</span>(input$done, {
      returnValue &lt;-<span class="st"> </span><span class="kw">list</span>(
        <span class="dt">selected_time =</span> <span class="kw">c</span>(<span class="kw">strftime</span>(<span class="kw">selcted_from</span>(), <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d-%H-%M&quot;</span>),<span class="kw">strftime</span>(<span class="kw">selcted_to</span>(), <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d-%H-%M&quot;</span>)),
        <span class="dt">selected_data =</span> <span class="kw">data.frame</span>(<span class="dt">date =</span> <span class="kw">index</span>(<span class="kw">sub_slctd</span>()),
                                   <span class="kw">coredata</span>(<span class="kw">sub_slctd</span>())),
        <span class="dt">selected_of =</span> <span class="kw">out_of</span>()
      )
      <span class="kw">stopApp</span>(returnValue)
    })
  }</code></pre></div>
<p>The <code>miniUI</code> is quite spartan. There is an <code>miniButtonBlock</code> that allows to select different basin, as as the <code>dygraph</code> output (i.e <code>hydrographs</code>) for the interactive exploration of the <span class="math inline">\(o\)</span> and <span class="math inline">\(s\)</span> data. The formatted table (<code>slctd_OF</code>) displays the different objective functions, that can be given to <code>explore_cos_data</code> .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  ui &lt;-<span class="st"> </span><span class="kw">miniPage</span>(
    <span class="kw">miniButtonBlock</span>(<span class="kw">selectInput</span>(<span class="st">&quot;basin_num&quot;</span>,
                                <span class="st">&quot;# basin:&quot;</span>,
                                <span class="dt">choices =</span> d_nums,
                                <span class="dt">selected =</span> <span class="dv">1</span>,
                                <span class="dt">selectize =</span> <span class="ot">FALSE</span>)),
    <span class="kw">miniContentPanel</span>(
      <span class="kw">fillCol</span>(
        <span class="dt">flex =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>),
        <span class="kw">dygraphOutput</span>(<span class="st">&quot;hydrographs&quot;</span>, <span class="dt">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;100%&quot;</span>),
        <span class="kw">fillCol</span>(
          <span class="dt">align =</span> <span class="st">&quot;center&quot;</span>,
          <span class="kw">textOutput</span>(<span class="st">&quot;selected_timewindow&quot;</span>),
          <span class="kw">tableOutput</span>(<span class="st">&quot;slctd_OF&quot;</span>)
        )
      )
    ),
    <span class="kw">gadgetTitleBar</span>(<span class="st">&quot;test&quot;</span>)
  )</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dyCrosshair &lt;-<span class="st"> </span>function(dygraph,
                        <span class="dt">direction =</span> <span class="kw">c</span>(<span class="st">&quot;both&quot;</span>, <span class="st">&quot;horizontal&quot;</span>, <span class="st">&quot;vertical&quot;</span>)) {
  <span class="kw">dyPlugin</span>(
    <span class="dt">dygraph =</span> dygraph,
    <span class="dt">name =</span> <span class="st">&quot;Crosshair&quot;</span>,
    <span class="dt">path =</span> <span class="kw">system.file</span>(<span class="st">&quot;examples/plugins/crosshair.js&quot;</span>,
                       <span class="dt">package =</span> <span class="st">&quot;dygraphs&quot;</span>),
    <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">direction =</span> <span class="kw">match.arg</span>(direction))
  )
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">runGadget</span>(ui,server)
<span class="er">}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plotting-runoff-peaks-plots.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="generate-previews.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["visdoc.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
