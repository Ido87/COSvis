---
title: "Flow Duration Curves"
author:
- "Daniel Klotz, Johannes Wesemann, Mathew Herrnegger"
date: "13 Juli 2016"
output:
  html_document:
    number_sections: yes
---

```{r setup, include=FALSE, purl=FALSE}
  knitr::opts_chunk$set(eval = FALSE, tidy = FALSE)
```

Work in Progress -> flow duration curves!
```{r}
  flow_duration_curve <- function(q, 
                                  log_y = TRUE,
                                  log_x = FALSE
                                  ...) {
  # a start for a single colum
  ylim <- range(q, na.rm = TRUE)
  n <- ncol(q)
  j <- 1
  # the log of zero cannot be taken, so hydroTSM implemented fail-saver
  if (((logarithm == "y") | (logarithm == "xy") | (logarithm == "yx")) & min(ylim) == 0) {
    tmp <- unlist(q)
    tmp[which(tmp == 0)] <- NA
    ylim[1] <- min(tmp, na.rm = TRUE)
  }
  tmp <- sort(q[, j])
  x <- as.numeric(q$q)
  x.old <- x
  x <- sort(x)
  x.zero.index <- which(x == 0)
  nzeros <- length(x.zero.index)
  ind <- match(x.old, x)
  n <- length(x)
  dc <- rep(NA, n)
  dc[1:n] <- sapply(1:n, function(j, y) {
      dc[j] <- length(which(y >= y[j]))
  }, y = x)
  dc <- dc/n
  ggplot2::qplot(x = dc, y = log(tmp), geom="point")
  }
```


