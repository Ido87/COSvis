---
title: "Examples for Cooking Data"
author: "Daniel Klotz"
date: "6 Juli 2016"
output:
  html_document:
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Here examples for **visCOS**-functions are given that deal with the process of
transforming  *raw data* into prepared data for **visCOS**.
The data is then *cooked* and can be used for figures etc.

# Getting raw data
From the point of view of **visCOS** raw-data are time-series of observations
and model output. Usually raw data is saved in some simple file format,
e.g. *.txt* or *.csv*. `R` already includes many option to read those files
with the `read.table` functionalities.
For larger unstructured files the read options of the `data.table` package is 
recommended. In our tests it was fastest and most flexible option.
Alternatively the `readr` can be used if the data is more structured and large.

The function `get_runoff_example` can be used to get some exemplary data
from within **visCOS**:
```{r, message=3:5}
  library(visCOS)
  require(magrittr)
  options(width=80)
  runoff_example_raw <- get_runoff_example()
  head(runoff_example_raw)
```

# Prepare the raw data
## Adapt `viscos_options`
The next step would be to adapt the first part of the `viscos_options`. This 
can be done by copying the default settings from the help and adapt them. In 
this case they are already correct:

```{r}
   viscos_options(
   # data.frame column names
      name_data1 = "qobs",
      name_data2 = "qsim",
      name_COSyear = "yyyy",
      name_COSmonth = "mm",
      name_COSday = "dd",
      name_COShour = "hh",
      name_COSmin = "min",
      name_COSposix = "posixdate",
      name_COSperiod = "period")
```
## Remove junk and prepare date format
Now all the junk data (data columns not needed, unobserved basins) can be 
removed using the `remove_chunk` function. Additionally, leading zeros in the 
column names can be deleted with `remove_leading_zeros` if necessary.

In order to properly analyse the data with **visCOS**, the timesteps must be 
complete and in the right format. This can be done with `prepare_complete_date`. 
Within the data.frame the user has to provide either 5 columns with the 
*COSdate* format: `yyyy-mm-dd-hh-min` i.e.: year-month-day-hour-minute or an 
equivalent column in `POSIXct` format (see: [link](https://stat.ethz.ch/R-manual/R-devel/library/base/html/as.POSIXlt.html))
 to do so.
```{r}
  runoff_example <- remove_chunk(runoff_example_raw) %>% 
  #remove_leading_zeros %>% 
  prepare_complete_date()
head(runoff_example)
```
## Define and Mark periods
If a seasonal or periodical analysis of the data wants to be done, these periods 
can be defined with the `mark_periods` function. In the example case, the 
hydrological years, going from September till August, will be defined:
```{r}
  runoff_example <- mark_periods(runoff_example, start_month = 9, end_month = 8)
# here is an example plot to visualise the periods
  plot(runoff_example$period, xlab="Timestep", ylab="# of hydrological year")
```

Note that the example data starts with beginning of September, so right with 
the first hydrological year. The end of the year 2010 is not completely inside 
a hydrological year, so the period counter jumps to one.
