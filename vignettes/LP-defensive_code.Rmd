# Defensive Code

```{r setup2, include=FALSE, purl=FALSE}
  knitr::opts_chunk$set(eval = FALSE, tidy = FALSE)
```

This section defines the internally used defensive programming part of **visCOS**.
This are all functions dedicated to ensure that **visCOS** is working nicely
even if it is used wrongly for whatever reason. This often means that a given
function has to return an error if certain criteria are not met!
Useful examples for such methods can be found in Hadley Wickhams `R` package [`assertthat`](https://cran.r-project.org/web/packages/assertthat/index.html)

## Code
The subsequent functions are defined in this section

function | exported
------------- | -------------
`assert_junk` | no
`assert_complete_date` | no
 `assert_dataframe` | no
`assert_of` | no

### Check for unwanted Columns
Tests if the given data.frame (`cos_data`) contains only the
columns defined within `get_regex_for_cos_data`
(see: [helpers](LP-helpers.html) and [`viscos_options`](LP-viscos_options.html)).
An exception throws an error.
**Note** that the check is not case sensitive!
```{r}
#' check for unwanted columns:
assert_junk <- function(cos_data) {
  data_names <- names(cos_data)
  no_junk_cols <- get_regex_for_cos_data( ) %>% grepl(., data_names, ignore.case = TRUE)
  if (any(no_junk_cols == FALSE)) {
    unwanted_cols <- paste(data_names[!no_junk_cols], collapse = ", ")
    stop(
      paste("There are still unwanted columns in the data. Check:", 
            unwanted_cols, 
            collapse = " ")
            )
  }
}
```

### Check Date 
A rough check for the needed date- and/or time-columns within the provided
`cos_data`. The function is rahter basic. It only checks if the names of the
`viscos_options("name_COSyear")` column and `viscos_options("name_COSposix") `
column exist (see: [`viscos_options`](LP-viscos_options.html)). An exceptions
throws an error.
```{r}
assert_complete_date <- function(cos_data) {
  OK_COSdate <- any(names(cos_data) == viscos_options("name_COSyear"))
  OK_POSIXdates <- any(names(cos_data) == viscos_options("name_COSposix"))
  # choose error messag depending on which columns are missing!
  if (!OK_COSdate & !OK_POSIXdates) {
    stop("No COSdates and no POSIXct-dates in the data!")
  } else if (OK_COSdate & !OK_POSIXdates) {
    stop("NO POSIXct fomrated column within the cos_data!")
  } else if (!OK_COSdate & OK_POSIXdates) {
    stop("NO COSdate year within the cos_data!")
  }
}
```

### Check for `data.frame`
Tests if `data` is a data.frame and returns an error if not.
```{r}
# uses stop if the input: "data" is not of class "data.frame"
assert_dataframe <- function(data) {
  require("tibble", quietly = TRUE)
  if ( !is.data.frame(data)&!is.tibble(data) ) stop("data needs to be a data_frame!")
}
```

## References
- Wickham, H. (2013). assertthat: Easy pre and post assertions. https://CRAN.R-project.org/package=assertthat
