---
title: "helpers"
author:
- "Daniel Klotz, Johannes Wesemann, Mathew Herrnegger"
date: "8 Juli 2016"
output:
  html_document:
    number_sections: yes
---

```{r setup, include=FALSE, purl=FALSE}
knitr::opts_chunk$set(eval = FALSE, tidy = FALSE)
```

# Introduction
This section collects small and helpful functions/scripts that are used
throughout **visCOS**.

None of the functions is exported!

# Code
The subsequent functions are defined below

function | exported
------------- | -------------
`get_regex_for_cos_data` | no
`get_basin_numbers` | no
`set_panel_size`| no

## `get_regex_for_cos_data`
This function can be called to get the names of the 8 allowed column-names
within **visCOS**. `get_regex_for_cos_data` takes no input, as it gets the
information directly from the global options (see: *viscos_options section*).
```{r}
get_regex_for_cos_data <- function() {
  regex_pattern <- paste("^",viscos_options("name_COSyear"),"$|",
                         "^",viscos_options("name_COSmonth"),"$|",
                         "^",viscos_options("name_COSday"),"$|",
                         "^",viscos_options("name_COShour"),"$|",
                         "^",viscos_options("name_COSmin"),"$|",
                         viscos_options("name_o"),".*|",
                         viscos_options("name_s"),".*|",
                         viscos_options("name_COSposix"),"|",
                         viscos_options("name_COSperiod"),
                         sep = "")
  return(regex_pattern)
}
```


## `get_basin_numbers`
This function fetches the number of basins from the provided data.frame
(`cos_data`) by removing all the non-digits characters from the column names.
```{r}
get_basin_numbers <- function(cos_data) {
  require("magrittr", quietly = TRUE)
  assert_dataframe(cos_data)
  assert_junk(cos_data)
  #
  d_names <- names(cos_data)
  d_nums <- d_names  %>% gsub('\\D','',.) %>% unique
  d_nums <- d_nums[!(d_nums == "")] %>% as.integer
  return(d_nums)
}


```

## `set_panel_size`
Klotz:
This function is most likely not needed anymore, but I honestly forgot what this function does!

 I think it is a good helper if multiple `ggplots` should be plotted within one plot.

```{r}
set_panel_size <- function(p=NULL, g = ggplotGrob(p), file=NULL,
                           margin = unit(1,"mm"),
                           width=unit(3, "cm"),
                           height=unit(2, "cm")){

  panels <- g$layout$name=="panel"
  panel_index_w<- g$layout$l[panels]
  panel_index_h<- g$layout$t[panels]
  nw <- length(unique(panel_index_w))
  nh <- length(unique(panel_index_h))
  g$widths[panel_index_w] <- rep(list(width), nw)
  g$heights[panel_index_h] <- rep(list(height), nh)
  class(g) <- c("fixed", class(g), "ggplot")
  if(!is.null(file))
    ggsave(file,
           g,
           width = convertWidth(sum(g$widths) + margin,
                                unitTo = "in", valueOnly = TRUE),
           height = convertHeight(sum(g$heights) + margin,
                                  unitTo = "in", valueOnly = TRUE))
  g
}
```
